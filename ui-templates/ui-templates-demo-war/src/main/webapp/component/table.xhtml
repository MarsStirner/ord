<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:e5ui="http://efive.ru/uitemplates"
      xmlns:e5ui-comp="http://efive.ru/uitemplates/composite"
      xmlns:c="http://java.sun.com/jsp/jstl/core">

    <ui:composition template="/WEB-INF/jsf-template/main.xhtml">
        <ui:define name="content">
            <h2>Table component</h2>

            <script type="text/javascript">
                document.ondblclick = function DoubleClick(evt) {
                    if (window.getSelection)
                        window.getSelection().removeAllRanges();
                    else if (document.selection)
                        document.selection.empty();
                }
            </script>

            <h:form id="form">
                <h:outputScript name="jsf.js" library="javax.faces" target="head"/>

                <h:commandLink action="#{contractList.refresh()}">
                    Refresh
                </h:commandLink>

                &nbsp;|&nbsp;

                <h:outputLink value="#{facesContext.externalContext.requestContextPath}/component/contract.xhtml">
                    Create new
                    <f:param name="docAction" value="create"/>
                </h:outputLink>

                &nbsp;|&nbsp;

                <h:outputText rendered="#{not contractList.groupingEnabled}"
                              style="font-weight: bold;"
                              value="No Group"/>
                <h:commandLink rendered="#{contractList.groupingEnabled}"
                               action="#{contractList.ungroup()}">
                    No Group
                </h:commandLink>

                &nbsp;|&nbsp;

                <h:outputText rendered="#{contractList.groupingEnabled and not contractList.groupingByCuratorEnabled}"
                              style="font-weight: bold;"
                              value="Group by Author"/>
                <h:commandLink rendered="#{not contractList.groupingEnabled or contractList.groupingByCuratorEnabled}"
                               action="#{contractList.groupByAuthor()}">
                    Group by Author
                </h:commandLink>

                &nbsp;|&nbsp;

                <h:outputText rendered="#{contractList.groupingByCuratorEnabled}" 
                              style="font-weight: bold;"
                              value="Group by Author and Curator"/>
                <h:commandLink rendered="#{not contractList.groupingByCuratorEnabled}"
                               action="#{contractList.groupByAuthorAndCurator()}">
                    Group by Author and Curator
                </h:commandLink>

                <h:panelGroup rendered="#{contractList.groupingEnabled}">
                    <div style="margin-top: 3px; margin-bottom: 5px;">
                        <a href="#" onclick="e5ui_dataTable.expandRowGroups('contracts'); return false;">
                            Expand all row groups
                        </a>
                        &nbsp;|&nbsp;
                        <a href="#" onclick="e5ui_dataTable.collapseRowGroups('contracts'); return false;">
                            Collapse all row groups
                        </a>
                        &nbsp;|&nbsp;
                        <a href="#" onclick="e5ui_dataTable.toggleRowGroups('contracts'); return false;">
                            Toggle all row groups
                        </a>
                    </div>
                </h:panelGroup>

                <e5ui:dataTable border="1"
                                style="border-collapse: collapse;"
                                captionStyle="font-size: 1.6em;"
                                width="100%"
                                value="#{contractList.documents}"
                                var="row"
                                id="contracts"
                                grouping="#{contractList.groupingEnabled}"
                                levelCount="#{contractList.groupingByCuratorEnabled? 3: 2}">

                    <f:facet name="caption">
                        Contract Table Demonstration
                    </f:facet>

                    <e5ui:row ondblclick="e5ui_util.clickElement(this, 'goToDocumentLink$');"
                              level="#{row.id le 0? -row.id: (contractList.groupingByCuratorEnabled? 2: 1)}"
                              group="#{row.id le 0}"
                              fullRow="#{row.id le 0}"
                              collapsed="true">

                        <f:facet name="fullRowLevel0">
                            <b>Author:</b> #{row.author.name}
                        </f:facet>

                        <f:facet name="fullRowLevel1">
                            <b>Curator:</b> #{row.curator.name}
                        </f:facet>

                        <f:facet name="fullRowDefault">
                            <b>???</b>
                        </f:facet>
                    </e5ui:row>

                    <e5ui:column>
                        <f:facet name="header">
                            <h:commandLink action="#{contractList.sort('id')}"
                                           disabled="#{contractList.groupingEnabled}">
                                ID
                            </h:commandLink>
                        </f:facet>
                        #{row.id}
                        <h:commandLink action="#{contractWorkflow.doAction('viewById', row.id)}"
                                       style="display: none"
                                       id="goToDocumentLink"/>
                    </e5ui:column>
                    <e5ui:column>
                        <f:facet name="header">Create Date</f:facet>
                        <h:outputText value="#{row.createDate}">
                            <f:convertDateTime pattern="dd.MM.yyyy"/>
                        </h:outputText>
                    </e5ui:column>
                    <e5ui:column order="2" rendered="#{not contractList.groupingByCuratorEnabled}">
                        <f:facet name="header">
                            <h:commandLink action="#{contractList.sort('curator')}"
                                           disabled="#{contractList.groupingEnabled}">
                                Curator
                            </h:commandLink>
                        </f:facet>
                        <h:outputText value="#{row.curator.name}"/>
                    </e5ui:column>
                    <e5ui:column order="2" rendered="#{contractList.groupingByCuratorEnabled}">
                        <f:facet name="header">
                            Curator (short)
                        </f:facet>
                        <h:outputText value="#{row.curator.shortName}"/>
                    </e5ui:column>
                    <e5ui:column order="1" rendered="#{not contractList.groupingEnabled}">
                        <f:facet name="header">
                            <h:commandLink action="#{contractList.sort('author')}"
                                           disabled="#{contractList.groupingEnabled}">
                                Author
                            </h:commandLink>
                        </f:facet>
                        <h:outputText value="#{row.author.name}"/>
                    </e5ui:column>
                    <e5ui:column order="1" rendered="#{contractList.groupingEnabled}">
                        <f:facet name="header">
                            Author (short)
                        </f:facet>
                        <h:outputText value="#{row.author.shortName}"/>
                    </e5ui:column>
                    <e5ui:column order="3">
                        <f:facet name="header">
                            <h:commandLink action="#{contractList.sort('sum')}"
                                           disabled="#{contractList.groupingEnabled}">
                                Sum
                            </h:commandLink>
                        </f:facet>
                        <h:outputText value="#{row.sum}">
                            <f:convertNumber type="currency"/>
                        </h:outputText>
                    </e5ui:column>
                    <e5ui:column order="3">
                        <f:facet name="header">Sum with VAT</f:facet>
                        <h:outputText value="#{row.sumWithVat}">
                            <f:convertNumber type="currency"/>
                        </h:outputText>
                    </e5ui:column>
                    <e5ui:column rendered="false">
                        <f:facet name="header">Action</f:facet>
                        <h:commandLink action="#{contractHolder.viewWithId(row.id)}">Go to</h:commandLink>
                    </e5ui:column>
                </e5ui:dataTable>
                <div style="padding:4px 0;text-align:center;" class="contracts-pager">
                    <e5ui-comp:tablePager id="pager" documentListHolder="#{contractList}" style="display:inline;" useLinks="false" />
                    <e5ui-comp:tablePageSizeSelector id="pageSizeSelector" documentListHolder="#{contractList}" style="display:inline;float:right;" pageSizes="10, 15, 20, 25, 30, 35, 40, 45, 50" />
                </div>
            </h:form>
        </ui:define>
    </ui:composition>
</html>
