<ui:component xmlns="http://www.w3.org/1999/xhtml"
              xmlns:ui="http://java.sun.com/jsf/facelets"
              xmlns:p="http://primefaces.org/ui"
              xmlns:h="http://java.sun.com/jsf/html"
              xmlns:cc="http://java.sun.com/jsf/composite">
    <cc:interface>
        <cc:attribute name="controller"
                      type="ru.efive.dms.uifaces.beans.task.DocumentTaskTreeHolder"
                      required="true"
                      shortDescription="reference to taskTreeController"/>
    </cc:interface>
    <cc:implementation>
        <!--@elvariable id="node" type="org.primefaces.model.TreeNode"-->
        <p:treeTable id="task_table" widgetVar="taskTableVar"
                     value="#{cc.attrs.controller.root}" var="row_task"
                     selectionMode="single" emptyMessage="Записей нет"
                     nodeVar="node" rowStyleClass="#{node.leaf ? 'leafNode' : 'parentNode'}">
            <!--@elvariable id="row_task" type="ru.entity.model.document.Task"-->
            <p:column headerText="Дата создания" style="width:12em;" styleClass="outputText">
                <h:outputText value="#{row_task.creationDate}" pattern="dd.MM.yyyy" converter="LocalDateTimeConverter"/>
            </p:column>
            <p:column headerText="Номер" styleClass="outputText">
                <h:outputText value="#{row_task.registrationNumber}"/>
            </p:column>
            <p:column headerText="Автор" styleClass="outputText">
                <h:outputText value="#{row_task.author.description}"/>
            </p:column>
            <p:column headerText="Исполнитель" styleClass="outputText">
                <ui:repeat value="#{row_task.executorsList}" var="executor">
                    <h:outputText value="#{executor.description}"/><br/>
                </ui:repeat>
            </p:column>
            <p:column headerText="Срок исполнения" styleClass="outputText">
                <h:outputText value="#{row_task.controlDate}" pattern="dd.MM.yyyy" converter="LocalDateTimeConverter"/>
            </p:column>
            <p:column headerText="Содержание" styleClass="outputText">
                <h:outputText value="#{row_task.shortDescription}"/>
            </p:column>
            <p:column headerText="Статус" styleClass="outputText">
                <h:outputText value="#{row_task.documentStatus.name}"/>
            </p:column>
            <p:column style="display:none;">#{row_task.id}</p:column>
            <p:ajax event="select" oncomplete="goToTask(PrimeFaces.widgets.taskTableVar.cursorNode.children()[7].textContent)"/>
        </p:treeTable>
        <p:toolbar id="taskToolBar">
            <p:toolbarGroup>
                <p:commandButton value="Обновить" id="refresh_btn" action="#{cc.attrs.controller.refresh}" update="task_table" icon="ui-icon-refresh"/>
                <p:commandButton value="Свернуть все" id="collapse_btn" action="#{cc.attrs.controller.collapseAll}" update="task_table" icon="ui-icon-carat-1-w"/>
                <p:commandButton value="Развернуть все" id="expand_btn" action="#{cc.attrs.controller.expandAll}" update="task_table" icon="ui-icon-carat-1-e"/>
                <!--UX: ADDITIONAL FACET FOR BUTTONS-->
                <cc:renderFacet name="additionalButtons"/>
            </p:toolbarGroup>
        </p:toolbar>
    </cc:implementation>
</ui:component>