<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:f="http://java.sun.com/jsf/core">

<ui:composition template="/jsf-template/referenceBookItemTemplate.xhtml">
    <f:metadata>
        <f:viewAction action="#{numerator.init}"/>
    </f:metadata>

    <ui:define name="VARIABLE_DEFINITIONS">
        <!-- Статусы документа -->
        <c:set var="stateEditable" value="#{numerator.createState or numerator.editState}" scope="view"/>
    </ui:define>

    <ui:define name="TOOLBAR_LEFT_GROUP_CONTENT">
        <p:button icon="ui-icon-home" outcome="/component/numerators.xhtml"/>
        <h:outputText value="Ошибка" rendered="#{numerator.errorState}"/>
        <p:commandButton value="Редактировать" action="#{numerator.edit}"
                         rendered="#{numerator.viewState and numerator.isCanUpdate(authData)}" icon="ui-icon-pencil" update="@form"/>
        <p:commandButton value="Отменить" action="#{numerator.view}" rendered="#{numerator.editState}" icon="ui-icon-cancel" update="@form"/>
        <p:commandButton value="Сохранить" action="#{numerator.save}" rendered="#{stateEditable}" icon="ui-icon-disk" update="@form"/>
        <p:commandButton value="Удалить" action="#{numerator.delete}" rendered="#{isAdministrator and numerator.viewState and numerator.isCanDelete(authData)}"
                         icon="ui-icon-trash" update="@form"/>
    </ui:define>
    <ui:define name="DOCUMENT_HEADER">
        <p:messages id="errorMessages" for="error" rendered="#{numerator.errorState}"/>
        <h:panelGroup layout="block" id="referenceBookHeaderDiv">Справочник Нумераторов</h:panelGroup>
        <h:panelGroup layout="block" id="documentHeaderDiv">
            <h:panelGroup rendered="#{numerator.createState}">
                <div class="name">Новый нумератор</div>
            </h:panelGroup>
            <h:panelGroup rendered="#{numerator.editState or numerator.viewState}">
                <div class="name">
                    <h:outputText value="Нумератор #"/>
                    <h:outputText value="#{numerator.document.id}"/>
                </div>
            </h:panelGroup>
            <h:panelGroup rendered="#{numerator.errorState}">
                <div class="name">Ошибка</div>
            </h:panelGroup>
        </h:panelGroup>
        <p:growl id="numeratorMessages"/>
    </ui:define>

    <ui:define name="DOCUMENT_CONTENT">
        <p:panelGrid style="width:100%">
            <p:row styleClass="ui-grid-row">
                <p:column styleClass="ui-grid-col-2">
                    <p:outputLabel for="v_prefix" value="Префикс к номеру:"/>
                </p:column>
                <p:column colspan="3" styleClass="ui-grid-col-10">
                    <h:outputText id="v_prefix" value="#{numerator.document.prefix}" styleClass="outputText" rendered="#{not stateEditable}"/>
                    <p:inputText id="e_prefix" value="#{numerator.document.prefix}" styleClass="inputText" rendered="#{stateEditable}"/>
                </p:column>
            </p:row>
            <p:row styleClass="ui-grid-row">
                <p:column styleClass="ui-grid-col-2">
                    <p:outputLabel for="v_current" value="Текущий номер:"/>
                </p:column>
                <p:column colspan="3" styleClass="ui-grid-col-10">
                    <h:outputText id="v_current" value="#{numerator.document.current}" styleClass="outputText" rendered="#{not numerator.createState}"/>
                    <p:inputText id="e_current" value="#{numerator.document.current}" styleClass="inputText" rendered="#{numerator.createState}"/>
                </p:column>
            </p:row>
            <p:row styleClass="ui-grid-row">
                <p:column styleClass="ui-grid-col-2">
                    <p:outputLabel for="e_commentary" value="Комментарий:"/>
                </p:column>
                <p:column colspan="3" styleClass="ui-grid-col-10">
                    <h:outputText id="v_commentary" value="#{numerator.document.shortDescription}"
                                  styleClass="outputText" rendered="#{not stateEditable}"/>
                    <p:inputText id="e_commentary" value="#{numerator.document.shortDescription}" styleClass="inputText" rendered="#{stateEditable}"/>
                </p:column>
            </p:row>
            <p:row styleClass="ui-grid-row">
                <p:column styleClass="ui-grid-col-2">
                    <p:outputLabel value="Срок действия:"/>
                </p:column>
                <p:column colspan="3" styleClass="ui-grid-col-10">
                    <h:outputText value="C "/>
                    <h:outputText value="#{numerator.document.begDate}" lang="ru" styleClass="outputText" rendered="#{not stateEditable}"
                                  converter="LocalDateConverter" pattern="yyyy.MM.dd"/>
                    <p:calendar id="begDateCalendar" value="#{numerator.document.begDate}" lang="ru" locale="ru"
                                converter="LocalDateConverter" pattern="dd.MM.yyyy" showOn="both" rendered="#{stateEditable}"/>
                    <h:outputText value=" ПО "/>
                    <h:outputText value="#{numerator.document.endDate}" lang="ru" styleClass="outputText" rendered="#{not stateEditable}"
                                  converter="LocalDateConverter" pattern="yyyy.MM.dd"/>
                    <p:calendar id="endDateCalendar" value="#{numerator.document.endDate}" lang="ru" locale="ru"
                                converter="LocalDateConverter" pattern="dd.MM.yyyy" showOn="both" rendered="#{stateEditable}"/>
                </p:column>
            </p:row>
            <p:row styleClass="ui-grid-row">
                <p:column styleClass="ui-grid-col-2">
                    <p:outputLabel for="v_priority" value="Приоритет:" title="чем выше тем лучше"/>
                </p:column>
                <p:column colspan="3" styleClass="ui-grid-col-10">
                    <h:outputText id="v_priority" value="#{numerator.document.priority}" styleClass="outputText" rendered="#{not stateEditable}"/>
                    <p:inputNumber id="e_priority" value="#{numerator.document.priority}" decimalPlaces="0" thousandSeparator=""  styleClass="inputText" rendered="#{stateEditable}"/>
                </p:column>
            </p:row>

            <p:row styleClass="ui-grid-row">
                <p:column styleClass="ui-grid-col-2">
                    <p:outputLabel for="v_documentType" value="Тип документа:"/>
                </p:column>
                <p:column colspan="3" styleClass="ui-grid-col-10">
                    <h:outputText id="v_documentType" value="#{numerator.document.documentType.value}" styleClass="outputText" rendered="#{not stateEditable}"/>
                    <p:selectOneMenu id="e_documentType" value="#{numerator.document.documentType}" converter="#{DocumentTypeConverter}"
                                     rendered="#{stateEditable}">
                        <f:selectItem noSelectionOption="true"/>
                        <f:selectItems value="#{refBookHelper.documentTypes}" var="docType_row"/>
                        <p:ajax update="e_documentForm"/>
                    </p:selectOneMenu>
                </p:column>
            </p:row>
            <p:row styleClass="ui-grid-row">
                <p:column styleClass="ui-grid-col-2">
                    <p:outputLabel for="v_documentForm" value="Вид документа:"/>
                </p:column>
                <p:column colspan="3" styleClass="ui-grid-col-10">
                    <h:outputText id="v_documentForm" value="#{numerator.document.documentForm.value}" styleClass="outputText" rendered="#{not stateEditable}"/>
                    <p:selectOneMenu id="e_documentForm" value="#{numerator.document.documentForm}" converter="#{DocumentFormConverter}"
                                     rendered="#{stateEditable}">
                        <f:selectItem noSelectionOption="true"/>
                        <f:selectItems value="#{refBookHelper.getDocumentFormsByCategory(numerator.document.documentType.code)}"/>
                    </p:selectOneMenu>
                </p:column>
            </p:row>
            <p:row styleClass="ui-grid-row">
                <p:column styleClass="ui-grid-col-2">
                    <p:outputLabel for="v_controller" value="Руководитель:" rendered="#{not stateEditable}"/>
                    <p:commandButton value="Руководитель" actionListener="#{numerator.chooseController}" rendered="#{stateEditable}" styleClass="dialogButton">
                        <p:ajax event="dialogReturn" listener="#{numerator.onControllerChosen}" update="v_controller"/>
                    </p:commandButton>
                </p:column>
                <p:column colspan="3" styleClass="ui-grid-col-10">
                    <h:outputText id="v_controller" value="#{numerator.document.controller.description}" styleClass="outputText"/>
                </p:column>
            </p:row>
            <p:row styleClass="ui-grid-row">
                <p:column styleClass="ui-grid-col-2">
                    <p:outputLabel for="v_contragent" value="Корреспондент:" rendered="#{not stateEditable}"/>
                    <p:commandButton value="Корреспондент" actionListener="#{numerator.chooseContragent}" rendered="#{stateEditable}" styleClass="dialogButton">
                        <p:ajax event="dialogReturn" listener="#{numerator.onContragentChosen}" update="v_contragent"/>
                    </p:commandButton>
                </p:column>
                <p:column styleClass="ui-grid-col-10" colspan="3">
                    <h:outputText id="v_contragent" value="#{numerator.document.contragent.value}" styleClass="outputText"/>
                </p:column>
            </p:row>
        </p:panelGrid>
    </ui:define>
</ui:composition>

</html>
