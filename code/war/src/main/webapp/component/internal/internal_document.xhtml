<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:e5ui="http://efive.ru/uitemplates"
      xmlns:e5ui-comp="http://efive.ru/uitemplates/composite"
      xmlns:p="http://primefaces.org/ui">

<ui:composition template="/jsf-template/template.xhtml">

    <ui:define name="running_head">
        <h:outputScript library="js" name="primefacesLocale_ru.js"/>
        <h:outputStylesheet library="css" name="primefacesExtension/calendarIcon.css"/>
    </ui:define>

    <ui:define name="header">
        <h:panelGroup rendered="#{internal_doc.viewState or internal_doc.createState or internal_doc.editState}">
            <div id="form_header">
                <div class="actionbar">
                    <div class="menu">
                        <div class="defbutton">
                            <h:outputLink value="/component/internal/internal_documents_by_number.xhtml">
                                <h:graphicImage value="#{resource['images:home.png']}"/>
                            </h:outputLink>
                        </div>
                        <div class="defbutton">
                            <h:commandLink action="#{internal_doc.edit}"
                                           rendered="#{internal_doc.viewState and internal_doc.editPermission}">
                                <h:graphicImage value="#{resource['images:edit_buttn.png']}"/>
                                Редактировать
                            </h:commandLink>
                        </div>
                        <div class="defbutton">
                            <h:commandLink action="#{internal_doc.save}"
                                           rendered="#{internal_doc.editState or internal_doc.createState}">
                                <h:graphicImage value="#{resource['images:save_buttn.png']}"/>
                                Сохранить
                            </h:commandLink>
                        </div>

                        <div class="defbutton">
                            <e5ui:formPart id="actions_fp">
                                <h:commandLink
                                        onclick="actionsModal.clickOpen('actionsModal'); return false;"
                                        rendered="#{internal_doc.executePermission and internal_doc.viewState}">
                                    <h:graphicImage value="#{resource['images:button-do.png']}"/>
                                    Действия
                                </h:commandLink>
                                <e5ui-comp:modalWindow id="actionsModal"
                                                       modalWindowHolder="#{internal_doc.processorModal}"
                                                       render=":main_content_form"
                                                       execute="selectedAction :main_content_form" showButtons="false"
                                                       widgetVar="actionsModal">
                                    <h:panelGroup
                                            rendered="#{not(internal_doc.processorModal.processingState)}">
                                        <div id="title">Действия</div>
                                    </h:panelGroup>
                                    <h:panelGroup
                                            rendered="#{internal_doc.processorModal.actionsAvailable}">
                                        <div class="wrap"
                                             style="height: 90px; background-color: #fff; clear: both;">
                                            <div class="inner" style="height: 90px;">
                                                <e5ui:dataTable id="action_select_table" border="0"
                                                                cellpadding="0" cellspacing="0"
                                                                value="#{internal_doc.processorModal.availableActions}"
                                                                var="row" grouping="false" width="100%">
                                                    <e5ui:row
                                                            onclick="e5ui_util.clickElement(this, 'selectLink$');"
                                                            styleClass="#{internal_doc.processorModal.selected(row)? 'grid_row_selected': ''}"/>
                                                    <e5ui:column>
                                                        <f:facet name="header">
                                                            <p>Доступные действия</p>
                                                        </f:facet>
                                                        <h:outputText value="#{row.action.name}"/>
                                                        <h:commandLink id="selectLink" style="display: none;"
                                                                       rendered="#{not internal_doc.processorModal.selected(row)}"
                                                                       action="#{internal_doc.processorModal.select(row)}"/>
                                                    </e5ui:column>
                                                </e5ui:dataTable>
                                            </div>
                                        </div>
                                    </h:panelGroup>
                                    <h:panelGroup
                                            rendered="#{internal_doc.processorModal.noActionsAvailable or internal_doc.processorModal.failureState or internal_doc.processorModal.processedState}">
                                        <div style="padding-left: 10px;">
                                            <ui:repeat
                                                    value="#{internal_doc.processorModal.actionResult.split(':')}"
                                                    var="element">
                                                <h:outputText value="#{element}"/>
                                                <br/>
                                            </ui:repeat>
                                        </div>
                                    </h:panelGroup>
                                    <h:panelGroup
                                            rendered="#{internal_doc.processorModal.processingState}">
                                        <e5ui:include
                                                data="#{internal_doc.processorModal.processedActivity.document.form}"/>
                                    </h:panelGroup>

                                    <div class="e5ui-modal-bottombuttons">
                                        <h:commandButton
                                                action="#{internal_doc.processorModal.process()}"
                                                rendered="#{internal_doc.processorModal.actionsAvailable or internal_doc.processorModal.processingState}"
                                                value="Выполнить"/>
                                        <h:button
                                                rendered="#{internal_doc.processorModal.actionsAvailable or internal_doc.processorModal.processingState}"
                                                onclick="actionsModal.clickClose(); return false;"
                                                value="Отмена"/>
                                        <h:button
                                                rendered="#{internal_doc.processorModal.noActionsAvailable or internal_doc.processorModal.failureState or internal_doc.processorModal.processedState}"
                                                onclick="actionsModal.clickClose(); return false;"
                                                value="Закрыть"/>
                                    </div>
                                </e5ui-comp:modalWindow>
                            </e5ui:formPart>
                        </div>
                        <div class="top">
                            <h:commandLink styleClass="top_link" onclick="return false;">
								<span>
                                    <h:graphicImage value="#{resource['images:button-print.png']}"/>
                                    Печать
								</span>
                            </h:commandLink>

                            <div class="sub">
                                <div class="item">
                                    <h:commandLink action='#{reports.previewSqlReportByRequestParams()}'>
                                        <h:graphicImage value="#{resource['images:blank.png']}"/>
                                        <f:param name="reportName" value="internal_note.jrxml"/>
                                        <f:param name="docId" value="#{internal_doc.document.id}"/>
                                        Справка о ходе выполнения документа
                                    </h:commandLink>
                                </div>
                            </div>
                        </div>
                        <div class="role">
                            <div class="top">
							<span>
                                <h:outputText value="#{internal_doc.document.getUserAccessLevel().value}"/>
							</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </h:panelGroup>
    </ui:define>

    <ui:define name="left_menu"/>

    <ui:define name="content">
        <p:growl id="viewFactMessage" for="viewFact"/>

        <div id="header_content">
            <div class="name">
                Внутренний документ
                <!--Давать выбирать вид документа на основании его статусов "Проект документа"-->
                <ui:param name="statusId_In_PROJ" value="#{internal_doc.document.documentStatus.id eq 1}"/>
                <h:selectOneMenu id="form" value="#{internal_doc.document.form}"
                                 converter="InternalDocumentFormConverter"
                                 immediate="true"
                                 rendered="#{internal_doc.createState or (internal_doc.editState and statusId_In_PROJ)}">
                    <f:selectItems value="#{dictionaryManagement.getDocumentFormsByCategory('Внутренние документы')}"/>
                </h:selectOneMenu>
                <h:outputText value="#{internal_doc.document.form}"
                              rendered="#{internal_doc.viewState or (internal_doc.editState and not statusId_In_PROJ)}"/>
                <h:outputText value=" № #{internal_doc.document.registrationNumber}"
                              rendered="#{internal_doc.editState or internal_doc.viewState}"/>
            </div>
            <div class="title">
                <h:outputText value="#{internal_doc.document.getDocumentStatus().getName()}"/>
            </div>
            <h:panelGroup rendered="#{internal_doc.notFoundState}">
                <div class="name">404 - Документ не найден</div>
            </h:panelGroup>
            <h:panelGroup rendered="#{internal_doc.forbiddenState}">
                <div class="name">
                    В доступе отказано.
                    <h:outputText value="#{internal_doc.stateComment}" lang="ru"/>
                </div>
            </h:panelGroup>
            <h:panelGroup
                    rendered="#{not(internal_doc.createState or internal_doc.editState or internal_doc.viewState or internal_doc.notFoundState or internal_doc.forbiddenState)}">
                <div class="name">В доступе отказано</div>
            </h:panelGroup>
        </div>

        <div class="main_content">
            <h:panelGroup rendered="#{internal_doc.editState or internal_doc.viewState or internal_doc.createState}">
                <div class="row">
                    <table class="form_grid">
                        <tr class="row">
                            <td class="third"/>
                            <td class="forth"/>
                            <td class="first">
                                <label>
                                    <span class="title">Автор:</span>
                                </label>
                            </td>
                            <td class="second">
                                <h:outputText value="#{internal_doc.document.author}" converter="PersonConverter"
                                              lang="ru"/>
                            </td>
                        </tr>
                    </table>
                </div>
            </h:panelGroup>
            <p:tabView widgetVar="internalDocumentTabViewVar" activeIndex="0" effect="fade" effectDuration="fast">
                <p:tab title="Реквизиты"
                       rendered="#{internal_doc.viewState or internal_doc.createState or internal_doc.editState}">
                    <h:panelGroup rendered="#{internal_doc.viewState}">
                        <div class="row">
                            <table class="form_grid">
                                <tr class="row">
                                    <td class="first">
                                        <label>
                                            <span class="title">Краткое	содержание:</span>
                                        </label>
                                    </td>
                                    <td class="second" colspan="3">
                                        <h:outputText value="#{internal_doc.document.shortDescription}"/>
                                    </td>
                                </tr>
                                <tr class="row">
                                    <td class="first">
                                        <label>
                                            <span class="title">Дата подписания:</span>
                                        </label>
                                    </td>
                                    <td class="second">
                                        <h:outputText value="#{internal_doc.document.signatureDate}">
                                            <f:convertDateTime type="date" pattern="dd.MM.yyyy"/>
                                        </h:outputText>
                                    </td>
                                    <td class="third">
                                        <label>
                                            <span class="title">Руководитель</span>
                                        </label>
                                    </td>
                                    <td class="forth">
                                        <h:outputText value="#{internal_doc.document.signer}"
                                                      converter="PersonConverter" class="wide"/>
                                    </td>
                                </tr>
                                <tr class="row">
                                    <td class="first">
                                        <label>
                                            <span class="title">Срок исполнения</span>
                                        </label>
                                    </td>
                                    <td class="second">
                                        <h:outputText value="#{internal_doc.document.executionDate}" lang="ru">
                                            <f:convertDateTime type="date" pattern="dd.MM.yyyy"/>
                                        </h:outputText>
                                    </td>
                                    <td class="third">
                                        <label>
                                            <span class="title">Контроль исполнения: </span>
                                        </label>
                                    </td>
                                    <td class="fourth">
                                        <h:outputText value="#{internal_doc.document.responsible}"
                                                      converter="PersonConverter" class="wide"/>
                                    </td>
                                </tr>
                                <tr class="row">
                                    <td class="first">
                                        <label>
                                            <span class="title">Адресаты</span>
                                        </label>
                                    </td>
                                    <td class="second" colspan="3">
                                        <div class="width"
                                             style="overflow-y: scroll; height: 120px">
                                            <ui:repeat value="#{internal_doc.document.recipientUsersList}"
                                                    var="element">
                                                <h:outputText value="#{element}"
                                                              converter="PersonConverter" class="width"/>
                                                <br/>
                                            </ui:repeat>
                                            <ui:repeat value="#{internal_doc.document.recipientGroupsList}"
                                                    var="element">
                                                <h:outputText value="#{element}" converter="GroupConverter"
                                                              class="width"/>
                                                <br/>
                                            </ui:repeat>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="row">
                                    <td class="first">
                                        <label>
                                            <span class="title">Номер в ERP</span>
                                        </label>
                                    </td>
                                    <td class="second">
                                        <h:outputText value="#{internal_doc.document.erpNumber}"/>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </h:panelGroup>
                    <h:panelGroup rendered="#{internal_doc.createState or internal_doc.editState}">
                        <div class="row">
                            <table class="form_grid">
                                <tr class="row">
                                    <td class="first">
                                        <label for="shortDescription">
                                            <span class="title">Краткое содержание</span>
                                        </label>
                                    </td>
                                    <td class="second" colspan="3">
                                        <h:inputText id="shortDescription"
                                                     value="#{internal_doc.document.shortDescription}" class="wide"/>
                                    </td>
                                </tr>
                                <tr class="row">
                                    <td class="first">
                                        <label>
                                            <span class="title">Дата подписания:</span>
                                        </label>
                                    </td>
                                    <td class="second">
                                        <p:calendar id="signatureDate" value="#{internal_doc.document.signatureDate}"
                                                    lang="ru" locale="ru"
                                                    widgetVar="signatureDateVar" pattern="dd.MM.yyyy" showOn="both"/>
                                    </td>
                                    <td class="third">
                                        <label>
            <span class="title">
                <h:outputLink title="Руководитель:"
                              onclick="signerSelectModalWidget.clickOpen('signerSelectModal'); return false;">
                    Руководитель
                </h:outputLink>
            </span>
                                        </label>
                                        <e5ui-comp:modalWindow id="signerSelectModal"
                                                               modalWindowHolder="#{internal_doc.signerSelectModal}"
                                                               render="signer" execute="select_table"
                                                               showButtons="false" style="width: 500px;"
                                                               widgetVar="signerSelectModalWidget">
                                            <div id="title">Выбор руководителя</div>
                                            <div id="modal_container" style="margin-top: 0;">
                                                <div class="searchbar">
                                                    <span style="float: left; margin-top: 3px">Поиск:&nbsp;</span>
                                                    <h:inputText id="filter_string"
                                                                 value="#{internal_doc.signerSelectModal.userList.filter}"
                                                                 style="display:block; float:left; margin-right:10px;"
                                                                 title="Поиск"/>
                                                    <h:commandButton value=" "
                                                                     action="#{internal_doc.signerSelectModal.userList.changePageOffset(0)}"
                                                                     styleClass="searchbutton">
                                                        <f:ajax execute="signerSelectModal:filter_string"
                                                                render="signerSelectModal:ajaxModal signerSelectModal:modal_paging"/>
                                                    </h:commandButton>
                                                </div>
                                                <div class="wrap"
                                                     style="height: 250px; width: 100%; margin: 0px;">
                                                    <div class="inner" style="height: 250px;">
                                                        <e5ui:dataTable id="select_table" border="0"
                                                                        cellpadding="0" cellspacing="0"
                                                                        value="#{staffManagement.findGroupByAlias('TopManagers').membersList}"
                                                                        var="row" grouping="false" width="100%">
                                                            <e5ui:row
                                                                    onclick="e5ui_util.clickElement(this, 'selectLink$');"
                                                                    styleClass="#{internal_doc.signerSelectModal.selected(row)? 'grid_row_selected': ''}"/>
                                                            <e5ui:column>
                                                                <f:facet name="header">
                                                                    <p>Руководитель</p>
                                                                </f:facet>
                                                                <h:outputText value="#{row}"
                                                                              converter="PersonConverter"/>
                                                                <h:commandLink id="selectLink" style="display: none;"
                                                                               rendered="#{not internal_doc.signerSelectModal.selected(row)}"
                                                                               action="#{internal_doc.signerSelectModal.select(row)}"/>
                                                            </e5ui:column>
                                                        </e5ui:dataTable>
                                                    </div>
                                                </div>
                                                <div style="clear: both;">
                                                    <h:panelGroup id="modal_paging" rendered="false">
                                                        <e5ui-comp:tablePager id="pager"
                                                                              documentListHolder="#{internal_doc.signerSelectModal.userList}"/>
                                                    </h:panelGroup>
                                                </div>
                                            </div>
                                            <div class="e5ui-modal-bottombuttons">
                                                <h:button onclick="signerSelectModalWidget.clickSave(); return false;"
                                                          value="Выбрать"/>
                                                <h:button onclick="signerSelectModalWidget.clickClose(); return false;"
                                                          value="Отмена"/>
                                            </div>
                                        </e5ui-comp:modalWindow>
                                    </td>
                                    <td class="fourth">
                                        <h:outputText id="signer" value="#{internal_doc.document.signer}"
                                                      converter="PersonConverter" class="wide"/>
                                    </td>
                                </tr>
                                <tr class="row">
                                    <td class="first">
                                        <label for="executionDate">
                                            <span class="title">Срок исполнения</span>
                                        </label>
                                    </td>
                                    <td class="second">
                                        <p:calendar id="executionDate" value="#{internal_doc.document.executionDate}"
                                                    lang="ru" locale="ru"
                                                    widgetVar="executionDateVar" pattern="dd.MM.yyyy" showOn="both"/>
                                    </td>
                                    <td class="third">
                                        <label>
            <span class="title">
                <h:outputLink onclick="responsibleSelectModalWidget.clickOpen('responsibleSelectModal'); return false;">
                    Контроль исполнения:
                </h:outputLink>
			</span>
                                        </label>
                                        <e5ui-comp:modalWindow id="responsibleSelectModal"
                                                               modalWindowHolder="#{internal_doc.responsibleSelectModal}"
                                                               render="executor" execute="select_table"
                                                               showButtons="false" style="width: 500px;"
                                                               widgetVar="responsibleSelectModalWidget">
                                            <div id="title">Выбор</div>
                                            <div id="modal_container" style="margin-top: 0;">
                                                <div class="searchbar">
                                                    <span style="float: left; margin-top: 3px">Поиск:&nbsp;</span>
                                                    <h:inputText id="users_filter_string"
                                                                 value="#{internal_doc.responsibleSelectModal.userList.filter}"
                                                                 style="display:block; float:left; margin-right:10px;"
                                                                 title="Поиск"/>
                                                    <h:commandButton value=" "
                                                                     action="#{internal_doc.responsibleSelectModal.userList.changePageOffset(0)}"
                                                                     styleClass="searchbutton">
                                                        <f:ajax execute="responsibleSelectModal:users_filter_string"
                                                                render="responsibleSelectModal:ajaxModal responsibleSelectModal:executors_modal_paging"/>
                                                    </h:commandButton>
                                                </div>
                                                <div class="wrap"
                                                     style="height: 250px; width: 100%; margin: 0px;">
                                                    <div class="inner" style="height: 250px;">
                                                        <e5ui:dataTable id="select_table" border="0"
                                                                        cellpadding="0" cellspacing="0"
                                                                        value="#{internal_doc.responsibleSelectModal.userList.documents}"
                                                                        var="row" grouping="false" width="100%">
                                                            <e5ui:row
                                                                    onclick="e5ui_util.clickElement(this, 'selectLink$');"
                                                                    styleClass="#{internal_doc.responsibleSelectModal.selected(row)? 'grid_row_selected': ''}"/>
                                                            <e5ui:column>
                                                                <f:facet name="header">
                                                                    <p>Контроль исполнения</p>
                                                                </f:facet>
                                                                <h:outputText value="#{row}"
                                                                              converter="PersonConverter"/>
                                                                <h:commandLink id="selectLink" style="display: none;"
                                                                               rendered="#{not internal_doc.responsibleSelectModal.selected(row)}"
                                                                               action="#{internal_doc.responsibleSelectModal.select(row)}"/>
                                                            </e5ui:column>
                                                        </e5ui:dataTable>
                                                    </div>
                                                </div>
                                                <div style="clear: both;">
                                                    <h:panelGroup id="executors_modal_paging">
                                                        <e5ui-comp:tablePager id="executors_pager"
                                                                              documentListHolder="#{internal_doc.responsibleSelectModal.userList}"/>
                                                    </h:panelGroup>
                                                </div>
                                            </div>
                                            <div class="e5ui-modal-bottombuttons">
                                                <h:button
                                                        onclick="responsibleSelectModalWidget.clickSave(); return false;"
                                                        value="Выбрать"/>
                                                <h:button
                                                        onclick="responsibleSelectModalWidget.clickClose(); return false;"
                                                        value="Отмена"/>
                                            </div>
                                        </e5ui-comp:modalWindow>
                                    </td>
                                    <td class="fourth">
                                        <h:outputText id="executor" value="#{internal_doc.document.responsible}"
                                                      converter="PersonConverter"
                                                      class="wide"/>
                                    </td>
                                </tr>
                                <tr class="row">
                                    <td class="first">
                                        <label>
            <span class="title">
                <h:outputLink title="Адресаты:"
                              onclick="userListSelectModalVar.clickOpen('recipientUnitsSelectModal'); return false;">
                    Адресаты
                </h:outputLink>
			</span>
                                        </label>
                                        <e5ui-comp:modalWindow id="recipientUnitsSelectModal"
                                                               modalWindowHolder="#{internal_doc.recipientUnitsSelectModal}"
                                                               render="recipients"
                                                               execute="users_select_table" showButtons="false"
                                                               style="width: 500px;" widgetVar="userListSelectModalVar">
                                            <div id="title">Выбор адресатов</div>
                                            <div id="modal_container" style="margin-top: 0;">
                                                <h:panelGroup rendered="#{internal_doc.isUsersDialogSelected()}">
                                                    <div class="searchbar">
                                                        <h:inputText id="users_filter_string"
                                                                     value="#{internal_doc.recipientUnitsSelectModal.userList.filter}"
                                                                     style="display:block; float:left; margin-right:10px;"
                                                                     title="Поиск"/>
                                                        <h:commandButton value=" "
                                                                         action="#{internal_doc.recipientUnitsSelectModal.userList.changePageOffset(0)}"
                                                                         styleClass="searchbutton">
                                                            <f:ajax
                                                                    execute="recipientUnitsSelectModal:users_filter_string"
                                                                    render="recipientUnitsSelectModal:ajaxModal recipientUnitsSelectModal:users_modal_paging"/>
                                                        </h:commandButton>
                                                    </div>
                                                    <div class="wrap"
                                                         style="height: 350px; width: 100%; margin: 0px;">
                                                        <div class="inner" style="height: 350px;">
                                                            <e5ui:dataTable id="select_table_users" border="0"
                                                                            cellpadding="0" cellspacing="0"
                                                                            value="#{internal_doc.recipientUnitsSelectModal.userList.documents}"
                                                                            var="row" grouping="false" width="100%">
                                                                <e5ui:row
                                                                        onclick="e5ui_util.clickElement(this, 'selectLink$');"
                                                                        styleClass="#{internal_doc.recipientUnitsSelectModal.selectedUser(row)? 'grid_row_selected': ''}"/>
                                                                <e5ui:column>
                                                                    <f:facet name="header">
                                                                        <p>Адресаты</p>
                                                                    </f:facet>
                                                                    <h:outputText value="#{row}"
                                                                                  converter="PersonConverter"/>
                                                                    <h:commandLink id="selectLink"
                                                                                   style="display: none;"
                                                                                   rendered="#{not internal_doc.recipientUnitsSelectModal.selectedUser(row)}"
                                                                                   action="#{internal_doc.recipientUnitsSelectModal.selectUser(row)}"/>
                                                                    <h:commandLink id="unselectLink"
                                                                                   style="display: none;"
                                                                                   rendered="#{internal_doc.recipientUnitsSelectModal.selectedUser(row)}"
                                                                                   action="#{internal_doc.recipientUnitsSelectModal.unselectUser(row)}"/>
                                                                </e5ui:column>
                                                            </e5ui:dataTable>
                                                        </div>
                                                    </div>
                                                    <div style="clear: both;">
                                                        <h:panelGroup id="users_modal_paging">
                                                            <e5ui-comp:tablePager id="usersPager"
                                                                                  documentListHolder="#{internal_doc.recipientUnitsSelectModal.userList}"/>
                                                        </h:panelGroup>
                                                    </div>

                                                </h:panelGroup>

                                                <h:panelGroup rendered="#{internal_doc.isGroupsDialogSelected()}">
                                                    <div class="searchbar">
                                                        <h:inputText id="groups_filter_string"
                                                                     value="#{internal_doc.recipientUnitsSelectModal.groupsView.filter}"
                                                                     style="display:block; float:left; margin-right:10px;"
                                                                     title="Поиск"/>
                                                        <h:commandButton value=" "
                                                                         action="#{internal_doc.recipientUnitsSelectModal.groupsView.changePageOffset(0)}"
                                                                         styleClass="searchbutton">
                                                            <f:ajax
                                                                    execute="recipientUnitsSelectModal:groups_filter_string"
                                                                    render="recipientUnitsSelectModal:ajaxModal recipientUnitsSelectModal:groups_modal_paging"/>
                                                        </h:commandButton>
                                                    </div>
                                                    <div class="wrap"
                                                         style="height: 350px; width: 100%; margin: 0px;">
                                                        <div class="inner" style="height: 350px;">
                                                            <e5ui:dataTable id="select_table_groups" border="0"
                                                                            cellpadding="0" cellspacing="0"
                                                                            value="#{internal_doc.recipientUnitsSelectModal.groupsView.documents}"
                                                                            var="row" grouping="false" width="100%">
                                                                <e5ui:row
                                                                        onclick="e5ui_util.clickElement(this, 'selectLink$');"
                                                                        styleClass="#{internal_doc.recipientUnitsSelectModal.selectedGroup(row)? 'grid_row_selected': ''}"/>
                                                                <e5ui:column>
                                                                    <f:facet name="header">
                                                                        <p>Адресаты</p>
                                                                    </f:facet>
                                                                    <h:outputText value="#{row}"
                                                                                  converter="GroupConverter"/>
                                                                    <h:commandLink id="selectLink"
                                                                                   style="display: none;"
                                                                                   rendered="#{not internal_doc.recipientUnitsSelectModal.selectedGroup(row)}"
                                                                                   action="#{internal_doc.recipientUnitsSelectModal.selectGroup(row)}"/>
                                                                    <h:commandLink id="unselectLink"
                                                                                   style="display: none;"
                                                                                   rendered="#{internal_doc.recipientUnitsSelectModal.selectedGroup(row)}"
                                                                                   action="#{internal_doc.recipientUnitsSelectModal.unselectGroup(row)}"/>
                                                                </e5ui:column>
                                                            </e5ui:dataTable>

                                                        </div>
                                                    </div>
                                                    <div style="clear: both;">
                                                        <h:panelGroup id="groups_modal_paging">
                                                            <e5ui-comp:tablePager id="groupsPager"
                                                                                  documentListHolder="#{internal_doc.recipientUnitsSelectModal.groupsView}"/>
                                                        </h:panelGroup>
                                                    </div>
                                                </h:panelGroup>
                                            </div>

                                            <div class="e5ui-modal-bottombuttons">
                                                <h:commandButton value="Группы пользователей"
                                                                 rendered="#{internal_doc.isUsersDialogSelected()}"
                                                                 action="#{internal_doc.setGroupsDialogSelected(true)}">
                                                    <f:ajax
                                                            render="recipientUnitsSelectModal:ajaxModal"
                                                            execute="recipientUnitsSelectModal:ajaxModal"/>
                                                </h:commandButton>
                                                <h:commandButton value="Пользователи"
                                                                 rendered="#{internal_doc.isGroupsDialogSelected()}"
                                                                 action="#{internal_doc.setUsersDialogSelected(true)}">
                                                    <f:ajax
                                                            render="recipientUnitsSelectModal:ajaxModal"
                                                            execute="recipientUnitsSelectModal:ajaxModal"/>
                                                </h:commandButton>
                                                <h:button onclick="userListSelectModalVar.clickSave(); return false;"
                                                          value="Выбрать"/>
                                                <h:button onclick="userListSelectModalVar.clickClose(); return false;"
                                                          value="Отмена"/>
                                            </div>
                                        </e5ui-comp:modalWindow>
                                    </td>
                                    <td class="second" colspan="3">
                                        <div style="overflow-y: scroll; height: 120px">
                                            <h:panelGroup id="recipients">
                                                <label>
                                                    <ui:repeat value="#{internal_doc.document.recipientUsersList}"
                                                               var="element">
                                                        <h:outputText value="#{element}" converter="PersonConverter"
                                                                      class="width"/>
                                                        <br/>
                                                    </ui:repeat>
                                                </label>
                                                <label>
                                                    <ui:repeat value="#{internal_doc.document.recipientGroupsList}"
                                                               var="element">
                                                        <h:outputText value="#{element}" converter="GroupConverter"
                                                                      class="width"/>
                                                        <br/>
                                                    </ui:repeat>
                                                </label>
                                            </h:panelGroup>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="row">
                                    <td class="first">
                                        <label>
                                            <span class="title">Номер в ERP</span>
                                        </label>
                                    </td>
                                    <td class="second">
                                        <h:inputText value="#{internal_doc.document.erpNumber}"/>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </h:panelGroup>
                </p:tab>
                <p:tab title="Движение документа"
                       rendered="#{internal_doc.viewState or internal_doc.createState or internal_doc.editState}">
                    <fieldset>
                        <legend>Поручения</legend>
                        <div class="actionbar">
                            <div class="menu">
                                <h:panelGroup rendered="#{(internal_doc.document.getDocumentStatus().getId() eq 5)}">
                                    <div class="defbutton">
                                        <h:outputLink value="/component/task/task.xhtml" target="_blank">
                                            <h:graphicImage value="#{resource['images:newf_buttn_icon.png']}"/>
                                            Новая резолюция
                                            <f:param name="docAction" value="create"/>
                                            <f:param name="rootDocumentId" value="#{internal_doc.document.uniqueId}"/>
                                            <f:param name="formId" value="resolution"/>
                                        </h:outputLink>
                                    </div>
                                </h:panelGroup>
                                <h:panelGroup rendered="#{(internal_doc.document.getDocumentStatus().getId() eq 80)}">
                                    <div class="defbutton">
                                        <h:outputLink value="/component/task/task.xhtml" target="_blank">
                                            <h:graphicImage value="#{resource['images:newf_buttn_icon.png']}"/>
                                            Новое поручение
                                            <f:param name="docAction" value="create"/>
                                            <f:param name="rootDocumentId" value="#{internal_doc.document.uniqueId}"/>
                                            <f:param name="formId" value="task"/>
                                        </h:outputLink>
                                    </div>
                                </h:panelGroup>
                                <h:panelGroup
                                        rendered="#{(internal_doc.document.form.value.equals('Служебная записка'))and(internal_doc.document.getDocumentStatus().getId() lt 80)}">
                                    <div class="defbutton">
                                        <h:outputLink value="/component/task/task.xhtml" target="_blank">
                                            <h:graphicImage value="#{resource['images:newf_buttn_icon.png']}"/>
                                            Новая задача
                                            <f:param name="docAction" value="create"/>
                                            <f:param name="rootDocumentId" value="#{internal_doc.document.uniqueId}"/>
                                            <f:param name="formId" value="exercise"/>
                                        </h:outputLink>
                                    </div>
                                </h:panelGroup>

                                <div class="defbutton">
                                    <h:commandLink action="#{internal_doc.taskTreeHolder.refresh()}">
                                        <f:ajax render="task_table"
                                                onevent="function(data){if (data.status === 'success'){addRowHandlers(); } }"/>
                                        <h:graphicImage value="#{resource['images:button-refresh.png']}"/>
                                        Обновить
                                    </h:commandLink>
                                </div>
                                <div class="defbutton">
                                    <h:commandLink action="#{internal_doc.taskTreeHolder.collapseAll()}">
                                        <h:graphicImage value="#{resource['images:minus.png']}"/>
                                        <f:ajax render="task_table"
                                                onevent="function(data){if (data.status === 'success'){addRowHandlers(); } }"/>
                                        Свернуть все
                                    </h:commandLink>
                                </div>
                                <div class="defbutton">
                                    <h:commandLink action="#{internal_doc.taskTreeHolder.expandAll()}">
                                        <h:graphicImage value="#{resource['images:plus.png']}"/>
                                        <f:ajax render="task_table"
                                                onevent="function(data){if (data.status === 'success'){addRowHandlers(); } }"/>
                                        Развернуть все
                                    </h:commandLink>
                                </div>
                            </div>
                        </div>
                        <h:panelGroup>
                            <style type="text/css">
                                /* Иконка раворачивания элемента */
                                .ui-icon-triangle-1-e {
                                    background-image: url('#{resource["images:plus.png"]}') !important;
                                    background-position: 0 0;
                                }

                                /* Иконка сворачивания элемента */
                                .ui-icon-triangle-1-s {
                                    background-image: url('#{resource["images:minus.png"]}') !important;
                                    background-position: 0 0;
                                }
                            </style>
                            <div style="height: 250px; width: 100%; margin: 0;">
                                <p:treeTable id="task_table"
                                             value="#{internal_doc.taskTreeHolder.root}"
                                             var="row_task"
                                             style="width:100%; overflow-x:hidden;"
                                             selectionMode="single"
                                             emptyMessage="Записей нет"
                                             widgetVar="taskTableVar">
                                    <p:column headerText="Дата создания">
                                        <h:outputText value="#{row_task.creationDate}">
                                            <f:convertDateTime type="date" pattern="dd.MM.yyyy"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Номер">
                                        <h:outputText value="#{row_task.taskNumber}"/>
                                    </p:column>
                                    <p:column headerText="Автор">
                                        <h:outputText value="#{row_task.author.getDescription()}"/>
                                    </p:column>
                                    <p:column headerText="Исполнитель">
                                        <ui:repeat value="#{row_task.executors}" var="executor">
                                            <h:outputText value="#{executor}" converter="PersonConverter"/>
                                            <br/>
                                        </ui:repeat>
                                    </p:column>
                                    <p:column headerText="Срок исполнения">
                                        <h:outputText value="#{row_task.controlDate}">
                                            <f:convertDateTime type="date" pattern="dd.MM.yyyy"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Содержание">
                                        <h:outputText value="#{row_task.shortDescription}"/>
                                    </p:column>
                                    <p:column headerText="Статус">
                                        <h:outputText value="#{row_task.getDocumentStatus().getName()}"/>
                                    </p:column>
                                    <p:column style="display:none;">
                                        <input type="hidden" value="#{row_task.id}"/>
                                    </p:column>
                                    <p:ajax event="expand" oncomplete="addRowHandlers()"/>
                                </p:treeTable>
                                <script type="text/javascript">
                                    function addRowHandlers() {
                                        console.log("refresh treetable row onclick handlers");
                                        var table_tree = document.getElementById(PrimeFaces.widgets.taskTableVar.id);
                                        var rows = table_tree.getElementsByClassName("task");
                                        for (var i = 0; i &lt; rows.length; i++) {
                                            var currentRow = rows[i];
                                            var createClickHandler = function (row) {
                                                return function () {
                                                    goToTask(row.lastChild.lastChild.value);
                                                };
                                            };
                                            document.getElementById(currentRow.id).className = document.getElementById(currentRow.id).className.replace('ui-state-highlight', '');
                                            currentRow.ondblclick = createClickHandler(currentRow);
                                        }
                                    }
                                    window.onload = addRowHandlers;
                                </script>
                            </div>
                        </h:panelGroup>
                    </fieldset>
                </p:tab>

                <p:tab title="Согласование"
                       rendered="#{(internal_doc.agreementTreeEditAvailable or internal_doc.agreementTreeViewAvailable) and (internal_doc.viewState or internal_doc.createState or internal_doc.editState)}">
                    <h:panelGroup id="agreement_tree_part">
                        <h:panelGroup rendered="#{internal_doc.agreementTreeViewAvailable}">
                            <div class="row" style="height: 250px; width: 100%; margin: 0px; padding: 0px">
                                <div class="wrap" style="width:100%; margin: 0px">
                                    <div class="inner">
                                        <e5ui:dataTable border="0" cellpadding="0" cellspacing="0"
                                                        var="row"
                                                        value="#{internal_doc.document.agreementTree.humanTaskTree}"
                                                        grouping="true" levelCount="100">
                                            <e5ui:row level="#{row.grouping}" group="#{row.parentNode}"
                                                      fullRow="false" collapsed="false"/>
                                            <e5ui:column>
                                                <f:facet name="header">
                                                    <p>Согласующий</p>
                                                </f:facet>
                                                <h:panelGroup rendered="#{row.groupedNode}">
                                                    <ui:repeat value="#{row.taskList}" var="element">
                                                        <h:outputText value="#{element.executor}"
                                                                      converter="PersonConverter"/>
                                                        <br/>
                                                    </ui:repeat>
                                                </h:panelGroup>
                                                <h:panelGroup rendered="#{not (row.groupedNode)}">
                                                    <h:outputText value="#{row.firstTask.executor}"
                                                                  converter="PersonConverter"/>
                                                </h:panelGroup>
                                            </e5ui:column>
                                            <e5ui:column
                                                    rendered="#{internal_doc.document.getDocumentStatus().getId() gt 1}">
                                                <h:panelGroup rendered="#{row.groupedNode}">
                                                    <ui:repeat value="#{row.taskList}" var="element">
                                                        <h:graphicImage
                                                                value="#{resource[element.getDocumentStatus().getId() eq 2?'images:document_letter_okay.png':(element.statusId eq -1? 'images:document_letter_remove.png': 'images:document_letter_warning.png')]}"/>
                                                        <br/>
                                                    </ui:repeat>
                                                </h:panelGroup>
                                                <h:panelGroup rendered="#{not (row.groupedNode)}">
                                                    <h:graphicImage
                                                            value="#{resource[row.firstTask.getDocumentStatus().getId() eq 2?'images:document_letter_okay.png':(row.firstTask.statusId eq -1? 'images:document_letter_remove.png': 'images:document_letter_warning.png')]}"/>
                                                </h:panelGroup>
                                            </e5ui:column>
                                            <e5ui:column
                                                    rendered="#{internal_doc.document.getDocumentStatus().getId() gt 1}">
                                                <h:panelGroup rendered="#{row.groupedNode}">
                                                    <ui:repeat value="#{row.taskList}" var="element">
                                                        <h:outputText value="#{element.commentary}"/>
                                                        <br/>
                                                    </ui:repeat>
                                                </h:panelGroup>
                                                <h:panelGroup rendered="#{not (row.groupedNode)}">
                                                    <h:outputText value="#{row.firstTask.commentary}"/>
                                                </h:panelGroup>
                                            </e5ui:column>
                                        </e5ui:dataTable>
                                    </div>
                                </div>
                            </div>
                        </h:panelGroup>
                        <h:panelGroup rendered="#{internal_doc.agreementTreeEditAvailable}">
                            <div class="row">
                                <div class="actionbar">
                                    <div class="menu">
                                        <h:panelGroup rendered="#{internal_doc.document.agreementTree eq null}">
                                            <div class="defbutton">
                                                <h:commandLink
                                                        action="#{humanTaskTreeControl.composeRouteTemplateSelectModal(internal_doc.document)}">
                                                    <h:graphicImage value="/resources/images/plus.png"/>
                                                    Новое согласование

                                                </h:commandLink>
                                            </div>
                                        </h:panelGroup>
                                        <h:panelGroup rendered="#{not (internal_doc.document.agreementTree eq null)}">
                                            <div class="defbutton">
                                                <h:commandLink
                                                        action="#{humanTaskTreeControl.addRootHumanTask(internal_doc.document.agreementTree)}">
                                                    <h:graphicImage value="/resources/images/plus.png"/>
                                                    Новая ветвь согласования

                                                </h:commandLink>
                                            </div>
                                        </h:panelGroup>
                                    </div>
                                </div>
                                <div class="wrap" style="height: 250px; width: 100%; margin: 0px;">
                                    <div class="inner" style="height: 250px;">
                                        <e5ui:dataTable id="route_template_table" border="0"
                                                        cellpadding="0" cellspacing="0" var="row"
                                                        value="#{internal_doc.document.agreementTree.humanTaskTree}"
                                                        grouping="true" levelCount="15"
                                                        rendered="#{not (internal_doc.document.agreementTree eq null)}">
                                            <e5ui:row level="#{row.grouping}" group="#{row.parentNode}"
                                                      fullRow="false" collapsed="false"/>
                                            <e5ui:column>
                                                <f:facet name="header">
                                                    <p>Согласующий</p>
                                                </f:facet>
                                                <h:panelGroup rendered="#{row.groupedNode}">
                                                    <ui:repeat value="#{row.taskList}" var="element">
                                                        <h:commandLink
                                                                action="#{humanTaskTreeControl.composeHumanTaskExecutorSelectModal(element)}">
                                                            <h:outputText
                                                                    value="#{element.executor eq null? '...': element.executor.description}"/>
                                                        </h:commandLink>
                                                        <br/>
                                                    </ui:repeat>
                                                </h:panelGroup>
                                                <h:panelGroup rendered="#{not (row.groupedNode)}">
                                                    <h:commandLink
                                                            action="#{humanTaskTreeControl.composeHumanTaskExecutorSelectModal(row.firstTask)}">
                                                        <h:outputText
                                                                value="#{row.firstTask.executor eq null? '...': row.firstTask.executor.description}"/>
                                                    </h:commandLink>
                                                </h:panelGroup>
                                            </e5ui:column>
                                            <e5ui:column>
                                                <h:commandLink
                                                        action="#{humanTaskTreeControl.addParallelHumanTask(internal_doc.document.agreementTree, row)}">
                                                    <h:graphicImage value="/resources/images/plus.png"/>
                                                    Параллельное согласование
                                                </h:commandLink>
                                            </e5ui:column>
                                            <e5ui:column>
                                                <h:commandLink
                                                        action="#{humanTaskTreeControl.addFollowingHumanTask(internal_doc.document.agreementTree, row)}">
                                                    <h:graphicImage value="/resources/images/plus.png"/>
                                                    Последовательное согласование
                                                </h:commandLink>
                                            </e5ui:column>
                                        </e5ui:dataTable>
                                        <e5ui-comp:modalWindow id="humanTaskExecutorSelectModal"
                                                               modalWindowHolder="#{humanTaskTreeControl.humanTaskExecutorSelectModal}"
                                                               render="route_template_table"
                                                               execute="user_select_table" showButtons="false"
                                                               style="width: 500px;"
                                                               widgetVar="humanTaskExecutorSelectModal">
                                            <div id="title">Выбор согласующего</div>
                                            <div id="user_list" style="margin-top: 0;">
                                                <div class="searchbar">
                                                    <h:inputText id="filter_string"
                                                                 value="#{humanTaskTreeControl.humanTaskExecutorSelectModal.userList.filter}"
                                                                 style="display:block; float:left; margin-right:10px;"
                                                                 title="Поиск"/>
                                                    <h:commandButton value=" "
                                                                     action="#{humanTaskTreeControl.humanTaskExecutorSelectModal.userList.changePageOffset(0)}"
                                                                     styleClass="searchbutton">
                                                        <f:ajax execute="humanTaskExecutorSelectModal:filter_string"
                                                                render="humanTaskExecutorSelectModal:user_select_table humanTaskExecutorSelectModal:user_paging"/>
                                                    </h:commandButton>
                                                </div>
                                                <div class="wrap"
                                                     style="height: 250px; background-color: #fff; clear: both;">
                                                    <div class="inner" style="height: 250px;">
                                                        <e5ui:dataTable id="user_select_table" border="0"
                                                                        cellpadding="0" cellspacing="0"
                                                                        value="#{humanTaskTreeControl.humanTaskExecutorSelectModal.userList.documents}"
                                                                        var="row" grouping="false" width="100%">
                                                            <e5ui:row
                                                                    onclick="e5ui_util.clickElement(this, 'selectLink$');"
                                                                    styleClass="#{humanTaskTreeControl.humanTaskExecutorSelectModal.selected(row)? 'grid_row_selected': ''}"/>
                                                            <e5ui:column>
                                                                <f:facet name="header">
                                                                    <p>Согласующий</p>
                                                                </f:facet>
                                                                <h:outputText value="#{row.description}"/>
                                                                <h:commandLink id="selectLink" style="display: none;"
                                                                               rendered="#{not humanTaskTreeControl.humanTaskExecutorSelectModal.selected(row)}"
                                                                               action="#{humanTaskTreeControl.humanTaskExecutorSelectModal.select(row)}"/>
                                                            </e5ui:column>
                                                        </e5ui:dataTable>
                                                    </div>
                                                </div>
                                                <div style="clear: both;">
                                                    <h:panelGroup id="user_paging">
                                                        <e5ui-comp:tablePager id="pager"
                                                                              documentListHolder="#{humanTaskTreeControl.humanTaskExecutorSelectModal.userList}"/>
                                                    </h:panelGroup>
                                                </div>
                                            </div>
                                            <div class="e5ui-modal-bottombuttons">
                                                <h:button
                                                        onclick="humanTaskExecutorSelectModal.clickSave(); return false;"
                                                        value="Выбрать"/>
                                                <h:button
                                                        onclick="humanTaskExecutorSelectModal.clickClose(); return false;"
                                                        value="Отмена"/>
                                            </div>
                                        </e5ui-comp:modalWindow>

                                        <e5ui-comp:modalWindow id="routeTemplateSelectModal"
                                                               modalWindowHolder="#{humanTaskTreeControl.routeTemplateSelectModal}"
                                                               render="agreement_tree_part"
                                                               execute="modal_select_table" showButtons="false"
                                                               style="width: 500px;"
                                                               widgetVar="routeTemplateSelectModal">
                                            <div id="title">Выбор шаблона согласования</div>
                                            <div id="modal_list" style="margin-top: 0;">
                                                <div class="wrap"
                                                     style="height: 250px; background-color: #fff; clear: both;">
                                                    <div class="inner" style="height: 250px;">
                                                        <e5ui:dataTable id="modal_select_table" border="0"
                                                                        cellpadding="0" cellspacing="0"
                                                                        value="#{humanTaskTreeControl.routeTemplateSelectModal.routeTemplateList.documents}"
                                                                        var="row" grouping="false" width="100%">
                                                            <e5ui:row
                                                                    onclick="e5ui_util.clickElement(this, 'selectLink$');"
                                                                    styleClass="#{humanTaskTreeControl.routeTemplateSelectModal.selected(row)? 'grid_row_selected': ''}"/>
                                                            <e5ui:column>
                                                                <f:facet name="header">
                                                                    <p>Шаблон согласования</p>
                                                                </f:facet>
                                                                <h:outputText value="#{row.name}"/>
                                                                <h:commandLink id="selectLink" style="display: none;"
                                                                               rendered="#{not humanTaskTreeControl.routeTemplateSelectModal.selected(row)}"
                                                                               action="#{humanTaskTreeControl.routeTemplateSelectModal.select(row)}"/>
                                                            </e5ui:column>
                                                        </e5ui:dataTable>
                                                    </div>
                                                </div>
                                                <div style="clear: both;">
                                                    <e5ui-comp:tablePager id="pager"
                                                                          documentListHolder="#{humanTaskTreeControl.routeTemplateSelectModal.routeTemplateList}"/>
                                                </div>
                                            </div>
                                            <div class="e5ui-modal-bottombuttons">
                                                <h:button onclick="routeTemplateSelectModal.clickSave(); return false;"
                                                          value="Выбрать"/>
                                                <h:button onclick="routeTemplateSelectModal.clickClose(); return false;"
                                                          value="Отмена"/>
                                            </div>
                                        </e5ui-comp:modalWindow>
                                    </div>
                                </div>
                            </div>
                        </h:panelGroup>
                    </h:panelGroup>
                </p:tab>

                <p:tab title="Связи"
                       rendered="#{internal_doc.viewState or internal_doc.createState or internal_doc.editState}">
                </p:tab>
                <p:tab title="Оригинал"
                       rendered="#{internal_doc.viewState or internal_doc.createState or internal_doc.editState}">
                    <fieldset>
                        <div class="actionbar">
                            <div class="menu">
                                <h:panelGroup rendered="#{internal_doc.document.getDocumentStatus().getId() gt 0}">
                                    <div class="defbutton">
                                        <h:outputLink value="/component/paper_copy_document.xhtml" target="_blank">
                                            <h:graphicImage value="#{resource['images:newf_buttn_icon.png']}"/>
                                            Новый оригинал
                                            <f:param name="docAction" value="create"/>
                                            <f:param name="parentDocumentId" value="#{internal_doc.document.uniqueId}"/>
                                        </h:outputLink>
                                    </div>
                                </h:panelGroup>

                                <div class="defbutton">
                                    <h:commandLink action="paperCopyDocuments.refresh()">
                                        <f:ajax render="select_table_2"/>
                                        <h:graphicImage value="#{resource['images:button-refresh.png']}"/>
                                        Обновить
                                    </h:commandLink>
                                </div>
                            </div>
                        </div>
                        <h:panelGroup>
                            <div id="modal_container" style="margin-top: 0;">
                                <div class="wrap"
                                     style="height: 250px; width: 100%; margin: 0px;">
                                    <div class="inner" style="height: 250px;">
                                        <e5ui:dataTable id="select_table_2" border="0"
                                                        cellpadding="0" cellspacing="0"
                                                        value="#{paperCopyDocuments.getAllDocumentsByParentDocumentId(internal_doc.document.uniqueId)}"
                                                        var="row" style="width:100%">
                                            <e5ui:row ondblclick="goToPaperCopyDocument('#{row.id}');"/>
                                            <e5ui:column>
                                                <f:facet name="header">
                                                    <p>Номер</p>
                                                </f:facet>
                                                <h:outputText value="#{row.registrationNumber}"/>
                                            </e5ui:column>
                                            <e5ui:column style="min-width:15em">
                                                <f:facet name="header">
                                                    <p>Заголовок</p>
                                                </f:facet>
                                                <h:outputText value="#{row.shortDescription}"/>
                                            </e5ui:column>
                                            <e5ui:column>
                                                <f:facet name="header">
                                                    <p>Статус</p>
                                                </f:facet>
                                                <h:outputText value="#{row.getDocumentStatus().getName()}"/>
                                            </e5ui:column>
                                        </e5ui:dataTable>
                                    </div>
                                </div>
                            </div>
                        </h:panelGroup>
                    </fieldset>
                </p:tab>

                <p:tab title="Доступ">
                    <h:panelGroup rendered="#{internal_doc.createState or internal_doc.editState}">
                        <div class="row">
                            <table class="form_grid">
                                <tr class="row">
                                    <td class="first">
                                        <label>
                                            <span class="title">Уровень допуска: </span>
                                        </label>
                                    </td>
                                    <td class="second" colspan="3">
                                        <h:selectOneMenu id="accessLevel"
                                                         value="#{internal_doc.document.userAccessLevel}"
                                                         converter="UserAccessLevelConverter">
                                            <f:selectItems
                                                    value="#{dictionaryManagement.getUserAccessLevelsGreaterOrEqualMaxValue(sessionManagement.getLoggedUser().getCurrentUserAccessLevel().level)}"/>
                                        </h:selectOneMenu>
                                    </td>
                                </tr>
                                <tr class="row">
                                    <td class="first" colspan="2">
                                        <fieldset>
                                            <legend>Пользователи</legend>
                                            <table class="form_grid">
                                                <tr class="row">
                                                    <td class="first">
                                                        <label>
                        <span class="title">
                            <h:outputLink title="Читатели:"
                                          onclick="personReadersPickListWidget.clickOpen('personReadersPickList'); return false;">
                                Читатели:
                            </h:outputLink>
						</span>
                                                        </label>
                                                        <e5ui-comp:modalWindow id="personReadersPickList"
                                                                               modalWindowHolder="#{internal_doc.personReadersPickList}"
                                                                               render="personReaders"
                                                                               execute="select_table"
                                                                               showButtons="false"
                                                                               style="width: 500px;"
                                                                               widgetVar="personReadersPickListWidget">
                                                            <div id="title">Выбор читателей</div>
                                                            <div id="modal_container" style="margin-top: 0;">
                                                                <div class="searchbar">
                                                                    <span style="float: left; margin-top: 3px">Поиск:&nbsp;</span>
                                                                    <h:inputText id="filter_string"
                                                                                 value="#{internal_doc.personReadersPickList.userList.filter}"
                                                                                 style="display:block; float:left; margin-right:10px;"
                                                                                 title="Поиск"/>
                                                                    <h:commandButton value=" "
                                                                                     action="#{internal_doc.personReadersPickList.userList.changePageOffset(0)}"
                                                                                     styleClass="searchbutton">
                                                                        <f:ajax execute="personReadersPickList:filter_string"
                                                                                render="personReadersPickList:select_table personReadersPickList:modal_paging"/>
                                                                    </h:commandButton>
                                                                </div>
                                                                <div class="wrap"
                                                                     style="height: 250px; width: 100%; margin: 0px;">
                                                                    <div class="inner" style="height: 250px;">
                                                                        <e5ui:dataTable id="select_table" border="0"
                                                                                        cellpadding="0" cellspacing="0"
                                                                                        value="#{internal_doc.personReadersPickList.userList.documents}"
                                                                                        var="row"
                                                                                        grouping="false" width="100%">
                                                                            <e5ui:row
                                                                                    onclick="e5ui_util.clickElement(this, 'selectLink$');"
                                                                                    styleClass="#{internal_doc.personReadersPickList.selected(row)? 'grid_row_selected': ''}"/>
                                                                            <e5ui:column>
                                                                                <f:facet name="header">
                                                                                    <p>Читатели</p>
                                                                                </f:facet>
                                                                                <h:outputText value="#{row}"
                                                                                              converter="PersonConverter"/>
                                                                                <h:commandLink id="selectLink"
                                                                                               style="display: none;"
                                                                                               rendered="#{not internal_doc.personReadersPickList.selected(row)}"
                                                                                               action="#{internal_doc.personReadersPickList.select(row)}"/>
                                                                                <h:commandLink id="unselectLink"
                                                                                               style="display: none;"
                                                                                               rendered="#{internal_doc.personReadersPickList.selected(row)}"
                                                                                               action="#{internal_doc.personReadersPickList.unselect(row)}"/>
                                                                            </e5ui:column>
                                                                        </e5ui:dataTable>
                                                                    </div>
                                                                </div>
                                                                <div style="clear: both;">
                                                                    <h:panelGroup id="modal_paging">
                                                                        <e5ui-comp:tablePager id="pager"
                                                                                              documentListHolder="#{internal_doc.personReadersPickList.userList}"/>
                                                                    </h:panelGroup>
                                                                </div>
                                                            </div>
                                                            <div class="e5ui-modal-bottombuttons">
                                                                <h:button
                                                                        onclick="personReadersPickListWidget.clickSave(); return false;"
                                                                        value="Выбрать"/>
                                                                <h:button
                                                                        onclick="personReadersPickListWidget.clickClose(); return false;"
                                                                        value="Отмена"/>
                                                            </div>
                                                        </e5ui-comp:modalWindow>
                                                    </td>
                                                    <td class="second" colspan="3">
                                                        <div style="overflow-y: scroll; height: 90px">
                                                            <h:panelGroup id="personReaders">
                                                                <label>
                                                                    <ui:repeat
                                                                            value="#{internal_doc.document.personReaders}"
                                                                            var="element">
                                                                        <h:outputText value="#{element}"
                                                                                      converter="PersonConverter"
                                                                                      class="width"/>
                                                                        <br/>
                                                                    </ui:repeat>
                                                                </label>
                                                            </h:panelGroup>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr class="row">
                                                    <td class="first">
                                                        <label>
                        <span class="title">
                            <h:outputLink title="Редакторы:"
                                          onclick="personEditorsPickListWidget.clickOpen('personEditorsPickList'); return false;">
                                Редакторы:
                            </h:outputLink>
						</span>
                                                        </label>
                                                        <e5ui-comp:modalWindow id="personEditorsPickList"
                                                                               modalWindowHolder="#{internal_doc.personEditorsPickList}"
                                                                               render="personEditors"
                                                                               execute="select_table"
                                                                               showButtons="false"
                                                                               style="width: 500px;"
                                                                               widgetVar="personEditorsPickListWidget">
                                                            <div id="title">Выбор редакторов</div>
                                                            <div id="modal_container" style="margin-top: 0;">
                                                                <div class="searchbar">
                                                                    <span style="float: left; margin-top: 3px">Поиск:&nbsp;</span>
                                                                    <h:inputText id="filter_string"
                                                                                 value="#{internal_doc.personEditorsPickList.userList.filter}"
                                                                                 style="display:block; float:left; margin-right:10px;"
                                                                                 title="Поиск"/>
                                                                    <h:commandButton value=" "
                                                                                     action="#{internal_doc.personEditorsPickList.userList.changePageOffset(0)}"
                                                                                     styleClass="searchbutton">
                                                                        <f:ajax
                                                                                execute="personEditorsPickList:filter_string"
                                                                                render="personEditorsPickList:select_table personEditorsPickList:modal_paging"/>
                                                                    </h:commandButton>
                                                                </div>
                                                                <div class="wrap"
                                                                     style="height: 250px; width: 100%; margin: 0px;">
                                                                    <div class="inner" style="height: 250px;">
                                                                        <e5ui:dataTable id="select_table" border="0"
                                                                                        cellpadding="0" cellspacing="0"
                                                                                        value="#{internal_doc.personEditorsPickList.userList.documents}"
                                                                                        var="row"
                                                                                        grouping="false" width="100%">
                                                                            <e5ui:row
                                                                                    onclick="e5ui_util.clickElement(this, 'selectLink$');"
                                                                                    styleClass="#{internal_doc.personEditorsPickList.selected(row)? 'grid_row_selected': ''}"/>
                                                                            <e5ui:column>
                                                                                <f:facet name="header">
                                                                                    <p>Редакторы</p>
                                                                                </f:facet>
                                                                                <h:outputText value="#{row}"
                                                                                              converter="PersonConverter"/>
                                                                                <h:commandLink id="selectLink"
                                                                                               style="display: none;"
                                                                                               rendered="#{not internal_doc.personEditorsPickList.selected(row)}"
                                                                                               action="#{internal_doc.personEditorsPickList.select(row)}"/>
                                                                                <h:commandLink id="unselectLink"
                                                                                               style="display: none;"
                                                                                               rendered="#{internal_doc.personEditorsPickList.selected(row)}"
                                                                                               action="#{internal_doc.personEditorsPickList.unselect(row)}"/>
                                                                            </e5ui:column>
                                                                        </e5ui:dataTable>
                                                                    </div>
                                                                </div>
                                                                <div style="clear: both;">
                                                                    <h:panelGroup id="modal_paging">
                                                                        <e5ui-comp:tablePager id="pager"
                                                                                              documentListHolder="#{internal_doc.personEditorsPickList.userList}"/>
                                                                    </h:panelGroup>
                                                                </div>
                                                            </div>
                                                            <div class="e5ui-modal-bottombuttons">
                                                                <h:button
                                                                        onclick="personEditorsPickListWidget.clickSave(); return false;"
                                                                        value="Выбрать"/>
                                                                <h:button
                                                                        onclick="personEditorsPickListWidget.clickClose(); return false;"
                                                                        value="Отмена"/>
                                                            </div>
                                                        </e5ui-comp:modalWindow>
                                                    </td>
                                                    <td class="second" colspan="3">
                                                        <div style="overflow-y: scroll; height: 90px">
                                                            <h:panelGroup id="personEditors">
                                                                <label>
                                                                    <ui:repeat
                                                                            value="#{internal_doc.document.personEditors}"
                                                                            var="element">
                                                                        <h:outputText value="#{element}"
                                                                                      converter="PersonConverter"
                                                                                      class="width"/>
                                                                        <br/>
                                                                    </ui:repeat>
                                                                </label>
                                                            </h:panelGroup>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr class="row">
                                                    <td class="first"/>
                                                    <td class="second"/>
                                                    <td class="third"/>
                                                    <td class="fourth"/>
                                                </tr>
                                            </table>
                                        </fieldset>
                                    </td>
                                    <td class="third" colspan="2">
                                        <fieldset>
                                            <legend>Роли</legend>
                                            <table class="form_grid">
                                                <tr class="row">
                                                    <td class="first">
                                                        <label>
                        <span class="title">
                            <h:outputLink title="Читатели:"
                                          onclick="roleReadersPickListWidget.clickOpen('roleReadersPickList'); return false;">
                                На чтение:
                            </h:outputLink>
						</span>
                                                        </label>
                                                        <e5ui-comp:modalWindow id="roleReadersPickList"
                                                                               modalWindowHolder="#{internal_doc.roleReadersPickList}"
                                                                               render="roleReaders"
                                                                               execute="select_table"
                                                                               showButtons="false"
                                                                               style="width: 500px;"
                                                                               widgetVar="roleReadersPickListWidget">
                                                            <div id="title">Выбор ролей читателей</div>
                                                            <div id="modal_container" style="margin-top: 0;">
                                                                <div class="searchbar">
                                                                    <span style="float: left; margin-top: 3px">Поиск:&nbsp;</span>
                                                                    <h:inputText id="filter_string"
                                                                                 value="#{internal_doc.roleReadersPickList.roleList.filter}"
                                                                                 style="display:block; float:left; margin-right:10px;"
                                                                                 title="Поиск"/>
                                                                    <h:commandButton value=" "
                                                                                     action="#{internal_doc.roleReadersPickList.roleList.changePageOffset(0)}"
                                                                                     styleClass="searchbutton">
                                                                        <f:ajax
                                                                                execute="roleReadersPickList:filter_string"
                                                                                render="roleReadersPickList:select_table roleReadersPickList:modal_paging"/>
                                                                    </h:commandButton>
                                                                </div>
                                                                <div class="wrap"
                                                                     style="height: 250px; width: 100%; margin: 0px;">
                                                                    <div class="inner" style="height: 250px;">
                                                                        <e5ui:dataTable id="select_table" border="0"
                                                                                        cellpadding="0" cellspacing="0"
                                                                                        value="#{roleList.documents}"
                                                                                        var="row"
                                                                                        grouping="false" width="100%">
                                                                            <e5ui:row
                                                                                    onclick="e5ui_util.clickElement(this, 'selectLink$');"
                                                                                    styleClass="#{internal_doc.roleReadersPickList.selected(row)? 'grid_row_selected': ''}"/>
                                                                            <e5ui:column>
                                                                                <f:facet name="header">
                                                                                    <p>Роли-читатели</p>
                                                                                </f:facet>
                                                                                <h:outputText value="#{row}"
                                                                                              converter="RoleConverter"/>
                                                                                <h:commandLink id="selectLink"
                                                                                               style="display: none;"
                                                                                               rendered="#{not internal_doc.roleReadersPickList.selected(row)}"
                                                                                               action="#{internal_doc.roleReadersPickList.select(row)}"/>
                                                                                <h:commandLink id="unselectLink"
                                                                                               style="display: none;"
                                                                                               rendered="#{internal_doc.roleReadersPickList.selected(row)}"
                                                                                               action="#{internal_doc.roleReadersPickList.unselect(row)}"/>
                                                                            </e5ui:column>
                                                                        </e5ui:dataTable>
                                                                    </div>
                                                                </div>
                                                                <div style="clear: both;">
                                                                    <h:panelGroup id="modal_paging">
                                                                        <e5ui-comp:tablePager id="pager"
                                                                                              documentListHolder="#{internal_doc.roleReadersPickList.roleList}"/>
                                                                    </h:panelGroup>
                                                                </div>
                                                            </div>
                                                            <div class="e5ui-modal-bottombuttons">
                                                                <h:button
                                                                        onclick="roleReadersPickListWidget.clickSave(); return false;"
                                                                        value="Выбрать"/>
                                                                <h:button
                                                                        onclick="roleReadersPickListWidget.clickClose(); return false;"
                                                                        value="Отмена"/>
                                                            </div>
                                                        </e5ui-comp:modalWindow>
                                                    </td>
                                                    <td class="second" colspan="3">
                                                        <div style="overflow-y: scroll; height: 90px">
                                                            <h:panelGroup id="roleReaders">
                                                                <label>
                                                                    <ui:repeat
                                                                            value="#{internal_doc.document.roleReaders}"
                                                                            var="element">
                                                                        <h:outputText value="#{element}"
                                                                                      converter="RoleConverter"
                                                                                      class="width"/>
                                                                        <br/>
                                                                    </ui:repeat>
                                                                </label>
                                                            </h:panelGroup>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr class="row">
                                                    <td class="first">
                                                        <label>
                        <span class="title">
                            <h:outputLink title="Редакторы:"
                                          onclick="roleEditorsPickListWidget.clickOpen('roleEditorsPickList'); return false;">
                                На редактирование:
                            </h:outputLink>
						</span>
                                                        </label>
                                                        <e5ui-comp:modalWindow id="roleEditorsPickList"
                                                                               modalWindowHolder="#{internal_doc.roleEditorsPickList}"
                                                                               render="roleEditors"
                                                                               execute="select_table"
                                                                               showButtons="false"
                                                                               style="width: 500px;"
                                                                               widgetVar="roleEditorsPickListWidget">
                                                            <div id="title">Выбор ролей редакторов</div>
                                                            <div id="modal_container" style="margin-top: 0;">
                                                                <div class="searchbar">
                                                                    <span style="float: left; margin-top: 3px">Поиск:&nbsp;</span>
                                                                    <h:inputText id="filter_string"
                                                                                 value="#{internal_doc.roleEditorsPickList.roleList.filter}"
                                                                                 style="display:block; float:left; margin-right:10px;"
                                                                                 title="Поиск"/>
                                                                    <h:commandButton value=" "
                                                                                     action="#{internal_doc.roleEditorsPickList.roleList.changePageOffset(0)}"
                                                                                     styleClass="searchbutton">
                                                                        <f:ajax
                                                                                execute="roleEditorsPickList:filter_string"
                                                                                render="roleEditorsPickList:select_table roleEditorsPickList:modal_paging"/>
                                                                    </h:commandButton>
                                                                </div>
                                                                <div class="wrap"
                                                                     style="height: 250px; width: 100%; margin: 0px;">
                                                                    <div class="inner" style="height: 250px;">
                                                                        <e5ui:dataTable id="select_table" border="0"
                                                                                        cellpadding="0" cellspacing="0"
                                                                                        value="#{roleList.documents}"
                                                                                        var="row"
                                                                                        grouping="false" width="100%">
                                                                            <e5ui:row
                                                                                    onclick="e5ui_util.clickElement(this, 'selectLink$');"
                                                                                    styleClass="#{internal_doc.roleEditorsPickList.selected(row)? 'grid_row_selected': ''}"/>
                                                                            <e5ui:column>
                                                                                <f:facet name="header">
                                                                                    <p>Роли-редакторы</p>
                                                                                </f:facet>
                                                                                <h:outputText value="#{row}"
                                                                                              converter="RoleConverter"/>
                                                                                <h:commandLink id="selectLink"
                                                                                               style="display: none;"
                                                                                               rendered="#{not internal_doc.roleEditorsPickList.selected(row)}"
                                                                                               action="#{internal_doc.roleEditorsPickList.select(row)}"/>
                                                                                <h:commandLink id="unselectLink"
                                                                                               style="display: none;"
                                                                                               rendered="#{internal_doc.roleEditorsPickList.selected(row)}"
                                                                                               action="#{internal_doc.roleEditorsPickList.unselect(row)}"/>
                                                                            </e5ui:column>
                                                                        </e5ui:dataTable>
                                                                    </div>
                                                                </div>
                                                                <div style="clear: both;">
                                                                    <h:panelGroup id="modal_paging">
                                                                        <e5ui-comp:tablePager id="pager"
                                                                                              documentListHolder="#{internal_doc.roleEditorsPickList.roleList}"/>
                                                                    </h:panelGroup>
                                                                </div>
                                                            </div>
                                                            <div class="e5ui-modal-bottombuttons">
                                                                <h:button
                                                                        onclick="roleEditorsPickListWidget.clickSave(); return false;"
                                                                        value="Выбрать"/>
                                                                <h:button
                                                                        onclick="roleEditorsPickListWidget.clickClose(); return false;"
                                                                        value="Отмена"/>
                                                            </div>
                                                        </e5ui-comp:modalWindow>
                                                    </td>
                                                    <td class="second" colspan="3">
                                                        <div style="overflow-y: scroll; height: 90px">
                                                            <h:panelGroup id="roleEditors">
                                                                <label>
                                                                    <ui:repeat
                                                                            value="#{internal_doc.document.roleEditors}"
                                                                            var="element">
                                                                        <h:outputText value="#{element}"
                                                                                      converter="RoleConverter"
                                                                                      class="width"/>
                                                                        <br/>
                                                                    </ui:repeat>
                                                                </label>
                                                            </h:panelGroup>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr class="row">
                                                    <td class="first"/>
                                                    <td class="second"/>
                                                    <td class="third"/>
                                                    <td class="fourth"/>
                                                </tr>
                                            </table>
                                        </fieldset>
                                    </td>
                                </tr>
                                <tr class="row">
                                    <td class="first"/>
                                    <td class="second"/>
                                    <td class="third"/>
                                    <td class="fourth"/>
                                </tr>
                            </table>
                        </div>
                    </h:panelGroup>

                    <h:panelGroup rendered="#{internal_doc.viewState}">
                        <div class="row">
                            <table class="form_grid">
                                <tr class="row">
                                    <td class="first">
                                        <label>
                                            <span class="title">Уровень допуска: </span>
                                        </label>
                                    </td>
                                    <td class="second" colspan="3">
                                        <h:outputText value="#{internal_doc.document.userAccessLevel}"
                                                      converter="UserAccessLevelConverter"/></td>
                                </tr>
                                <tr class="row">
                                    <td class="first" colspan="2">
                                        <fieldset>
                                            <legend>Пользователи</legend>
                                            <table class="form_grid">
                                                <tr class="row">
                                                    <td class="first">
                                                        <label>
                                                            <span class="title">Читатели: </span>
                                                        </label>
                                                    </td>
                                                    <td class="second" colspan="3">
                                                        <div style="overflow-y: scroll; height: 90px">
                                                            <label>
                                                                <ui:repeat
                                                                        value="#{internal_doc.document.personReaders}"
                                                                        var="element">
                                                                    <h:outputText value="#{element}"
                                                                                  converter="PersonConverter"
                                                                                  class="width"/>
                                                                    <br/>
                                                                </ui:repeat>
                                                            </label>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr class="row">
                                                    <td class="first">
                                                        <label>
                                                            <span class="title">Редакторы: </span>
                                                        </label>
                                                    </td>
                                                    <td class="second" colspan="3">
                                                        <div style="overflow-y: scroll; height: 90px">
                                                            <label>
                                                                <ui:repeat
                                                                        value="#{internal_doc.document.personEditors}"
                                                                        var="element">
                                                                    <h:outputText value="#{element}"
                                                                                  converter="PersonConverter"
                                                                                  class="width"/>
                                                                    <br/>
                                                                </ui:repeat>
                                                            </label>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr class="row">
                                                    <td class="first"/>
                                                    <td class="second"/>
                                                    <td class="third"/>
                                                    <td class="fourth"/>
                                                </tr>
                                            </table>
                                        </fieldset>
                                    </td>
                                    <td class="third" colspan="2">
                                        <fieldset>
                                            <legend>Роли</legend>
                                            <table class="form_grid">
                                                <tr class="row">
                                                    <td class="first">
                                                        <label>
                                                            <span class="title">На чтение: </span>
                                                        </label>
                                                    </td>
                                                    <td class="second" colspan="3">
                                                        <div style="overflow-y: scroll; height: 90px">
                                                            <label>
                                                                <ui:repeat value="#{internal_doc.document.roleReaders}"
                                                                           var="element">
                                                                    <h:outputText value="#{element}"
                                                                                  converter="RoleConverter"
                                                                                  class="width"/>
                                                                    <br/>
                                                                </ui:repeat>
                                                            </label>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr class="row">
                                                    <td class="first">
                                                        <label>
                                                            <span class="title">На редактирование:</span>
                                                        </label>
                                                    </td>
                                                    <td class="second" colspan="3">
                                                        <div style="overflow-y: scroll; height: 90px">
                                                            <label>
                                                                <ui:repeat value="#{internal_doc.document.roleEditors}"
                                                                           var="element">
                                                                    <h:outputText value="#{element}"
                                                                                  converter="RoleConverter"
                                                                                  class="width"/>
                                                                    <br/>
                                                                </ui:repeat>
                                                            </label>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr class="row">
                                                    <td class="first"/>
                                                    <td class="second"/>
                                                    <td class="third"/>
                                                    <td class="fourth"/>
                                                </tr>
                                            </table>
                                        </fieldset>
                                    </td>
                                </tr>
                                <tr class="row">
                                    <td class="first"/>
                                    <td class="second"/>
                                    <td class="third"/>
                                    <td class="fourth"/>
                                </tr>
                            </table>
                        </div>
                    </h:panelGroup>
                </p:tab>

                <p:tab title="История"
                       rendered="#{internal_doc.viewState or internal_doc.createState or internal_doc.editState}">
                    <div style="width: 100%; margin: 0;">
                        <p:dataTable id="history_list" value="#{internal_doc.document.historyList}"
                                     var="history_entry" grouping="false">
                            <p:column headerText="Дата">
                                <h:outputText value="#{history_entry.startDate}">
                                    <f:convertDateTime type="date" pattern="dd.MM.yyyy HH:mm:ss"/>
                                </h:outputText>
                            </p:column>
                            <p:column headerText="Статус">
                                <h:outputText value="#{history_entry.fromStatusName}"/>
                            </p:column>
                            <p:column headerText="Действие">
                                <h:outputText value="#{history_entry.actionName}"/>
                            </p:column>
                            <p:column headerText="Автор">
                                <h:outputText value="#{history_entry.owner.descriptionShort}"/>
                            </p:column>
                            <p:column headerText="Комментарий">
                                <h:outputText value="#{history_entry.commentary}"/>
                            </p:column>
                        </p:dataTable>
                    </div>
                </p:tab>
            </p:tabView>
        </div>

        <p:ajaxStatus onstart="PF('statusDialog').show()" oncomplete="PF('statusDialog').hide()"/>
        <p:dialog widgetVar="statusDialog" modal="true" draggable="false" closable="false" resizable="false"
                  showHeader="false">
            Пожалуйста, подождите...
        </p:dialog>

    </ui:define>

    <ui:define name="footer">
        <h:form id="file_upload_form" enctype="multipart/form-data"
                rendered="#{internal_doc.viewState or internal_doc.createState or internal_doc.editState}">
            <div style="padding-top: 10px;">
                <fieldset>
                    <legend>Файлы</legend>
                    <div class="menu">
                        <div class="defbutton">
                            <e5ui:fileUpload id="file_upload" multiple="true"
                                             actionBehavior="separate" maxFilesCount="0"
                                             uploadHandler="#{fileManagement.uploadHandler}"
                                             action="#{internal_doc.uploadAttachments(fileManagement.details)}"
                                             onuploading="e5ui_ajaxStatus.ajsgStopped=true;splash_screen_2.startShow();"
                                             onuploaded="splash_screen_2.stopShow();e5ui_ajaxStatus.ajsgStopped=false;">
                                <f:ajax render="file_upload_form"/>
                            </e5ui:fileUpload>
                        </div>
                        <div class="defbutton">
                            <h:commandLink action="#{internal_doc.updateAttachments()}">
                                <h:graphicImage value="#{resource['images:button-refresh.png']}"/>
                                Обновить
                                <f:ajax render=":file_upload_form"/>
                            </h:commandLink>
                        </div>
                    </div>
                    <div style="margin-top: 10px;">
                        <div class="wrap_main" id="table_wrap">
                            <div class="inner" id="table_inner">
                                <e5ui:dataTable border="0" cellpadding="0" cellspacing="0"
                                                id="file_table" value="#{internal_doc.attachments}" var="row">
                                    <e5ui:column>
                                        <h:outputText value="#{row.currentRevision.fileName}"/>
                                    </e5ui:column>
                                    <e5ui:column>
                                        <h:outputText value="#{row.currentRevision.version}"/>
                                    </e5ui:column>
                                    <e5ui:column>
                                        <h:outputText
                                                value="#{userList.getUserFullNameById(row.currentRevision.authorId)}"/>
                                    </e5ui:column>
                                    <e5ui:column>
                                        <h:outputLink value="/component/file/download.xhtml" target="_blank">
                                            <h:graphicImage value="/resources/images/download_doc.gif"/>
                                            <f:param name="id" value="#{row.id}"/>
                                            Скачать
                                        </h:outputLink>
                                    </e5ui:column>
                                    <e5ui:column>
                                        <h:commandLink action="#{internal_doc.initializeVersionAppender(row)}">
                                            <h:graphicImage value="/resources/images/CheckOut_icon.gif"/>
                                            <f:ajax render=":file_upload_form"/>
                                            Добавить версию документа
                                        </h:commandLink>
                                    </e5ui:column>
                                    <e5ui:column>
                                        <h:commandLink action="#{internal_doc.initializeVersionHistory(row)}">
                                            <h:graphicImage value="/resources/images/CheckOut_icon.gif"/>
                                            <f:ajax render=":file_upload_form"/>
                                            История версий
                                        </h:commandLink>
                                    </e5ui:column>
                                    <e5ui:column>
                                        <h:commandLink action="#{internal_doc.deleteAttachment(row)}">
                                            <h:graphicImage value="/resources/images/delete.gif"/>
                                            <f:ajax render=":file_upload_form :main_content_form"/>
                                            Удалить
                                        </h:commandLink>
                                    </e5ui:column>
                                </e5ui:dataTable>

                                <e5ui-comp:modalWindow id="versionAppenderModal"
                                                       modalWindowHolder="#{internal_doc.versionAppenderModal}"
                                                       render=":file_upload_form" execute=":file_upload_form"
                                                       style="width:300px;" showButtons="false"
                                                       widgetVar="versionAppenderModal">
                                    <div id="title">Добавление версии документа</div>
                                    <div id="modal_container" style="margin-top: 0;">
                                        <div>
                                            Документ:
                                            <h:outputText
                                                    value="#{internal_doc.versionAppenderModal.attachment.currentRevision.fileName}"/>
                                        </div>
                                        <div>
                                            Текущая версия:
                                            <h:outputText
                                                    value="#{internal_doc.versionAppenderModal.attachment.currentRevision.version}"/>
                                        </div>
                                        <div>
                                            <h:selectBooleanCheckbox
                                                    value="#{internal_doc.versionAppenderModal.majorVersion}"/>
                                            Увеличить старший номер
                                        </div>
                                        <div style="margin-top: 5px;">
                                            <e5ui:fileUpload id="version_upload" multiple="false"
                                                             actionBehavior="separate" maxFilesCount="1"
                                                             uploadHandler="#{fileManagement.uploadHandler}"
                                                             action="#{internal_doc.versionAppenderModal.saveAttachment}"
                                                             onuploading="e5ui_ajaxStatus.ajsgStopped=true;splash_screen_2.startShow();"
                                                             onuploaded="splash_screen_2.stopShow();e5ui_ajaxStatus.ajsgStopped=false;">
                                                <f:ajax render=":file_upload_form"
                                                        execute=":file_upload_form:versionAppenderModal"/>
                                            </e5ui:fileUpload>
                                        </div>
                                    </div>
                                    <div class="e5ui-modal-bottombuttons">
                                        <h:button
                                                onclick="versionAppenderModal.clickClose(); return false;"
                                                value="Отмена"/>
                                    </div>
                                </e5ui-comp:modalWindow>

                                <e5ui-comp:modalWindow id="versionHistoryModal"
                                                       modalWindowHolder="#{internal_doc.versionHistoryModal}"
                                                       render=":file_upload_form" execute=":file_upload_form"
                                                       style="width:500px;" showButtons="false"
                                                       widgetVar="versionHistoryModal">
                                    <div id="title">История версий документа</div>
                                    <div id="modal_container" style="margin-top: 0;">
                                        <div class="wrap_main" id="table_wrap">
                                            <div class="inner" id="table_inner">
                                                <e5ui:dataTable border="0" cellpadding="0" cellspacing="0"
                                                                id="version_table"
                                                                value="#{internal_doc.versionHistoryModal.versionList}"
                                                                var="row">
                                                    <e5ui:column style="min-width:8em;">
                                                        <h:outputText
                                                                value="#{row.fileName eq null? internal_doc.versionHistoryModal.attachment.fileName: row.fileName}"/>
                                                    </e5ui:column>
                                                    <e5ui:column style="min-width:5em;">
                                                        <h:outputText value="#{row.version}"/>
                                                    </e5ui:column>
                                                    <e5ui:column style="min-width:12em;">
                                                        <h:outputText
                                                                value="#{userList.getUserFullNameById(row.authorId eq 0? internal_doc.versionHistoryModal.attachment.authorId: row.authorId)}"/>
                                                    </e5ui:column>
                                                    <e5ui:column style="min-width:7em;">
                                                        <h:outputLink value="/component/file/download.xhtml"
                                                                      target="_blank">
                                                            <h:graphicImage value="/resources/images/download_doc.gif"/>
                                                            <f:param name="id"
                                                                     value="#{internal_doc.versionHistoryModal.attachment.id}"/>
                                                            <f:param name="revision" value="#{row.version}"/>
                                                            Скачать
                                                        </h:outputLink>
                                                    </e5ui:column>
                                                </e5ui:dataTable>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="e5ui-modal-bottombuttons">
                                        <h:button onclick="versionHistoryModal.clickClose(); return false;"
                                                  value="Закрыть"/>
                                    </div>
                                </e5ui-comp:modalWindow>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </div>
            <e5ui-comp:splashScreen id="splash_screen_2"
                                    widgetVar="splash_screen_2" timeout="0">
                <f:facet name="timeoutPanel">
                    <div
                            style="background-color: white; border-top: solid 1px black; border-bottom: solid 1px black; padding: 30px; text-align: center; margin: 200px auto; width: 300px;">
                        Пожалуйста, подождите...
                    </div>
                </f:facet>
            </e5ui-comp:splashScreen>
            <script>
                e5ui_splashScreen.startShowOnSubmit('splash_screen_2',
                        ['file_upload_form']);
            </script>
        </h:form>

        <h:outputStylesheet library="css" name="datatable.css"/>
        <h:outputStylesheet library="css" name="modalWindow.css"/>
    </ui:define>

</ui:composition>

</html>