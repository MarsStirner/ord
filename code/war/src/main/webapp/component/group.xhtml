<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<ui:composition template="/jsf-template/referenceBookItemTemplate.xhtml">
    <ui:define name="contentReferenceBookName">Справочник групп</ui:define>
    <ui:define name="contentItemName">
        <h:panelGroup rendered="#{group.createState}">
            <div class="name">Новая группа</div>
        </h:panelGroup>
        <h:panelGroup rendered="#{group.editState or group.viewState}">
            <div class="name">
                <h:outputText value="#{group.document.value}"/>
            </div>
        </h:panelGroup>
        <h:panelGroup rendered="#{group.notFoundState}">
            <div class="name">404 - Группа не найдена</div>
        </h:panelGroup>
        <h:panelGroup rendered="#{group.forbiddenState}">
            <div class="name">403 - Действие запрещено</div>
        </h:panelGroup>
        <h:panelGroup rendered="#{not(group.createState or group.editState or group.viewState or group.notFoundState or group.forbiddenState)}">
            <div class="name">В доступе отказано</div>
        </h:panelGroup>
    </ui:define>

    <ui:define name="headerEditButton">
        <div class="defbutton">
            <p:commandLink action="#{group.edit}" rendered="#{group.viewState}" update="@all">
                <h:graphicImage value="#{resource['images:edit_buttn.png']}"/>
                Редактировать
            </p:commandLink>
        </div>
    </ui:define>
    <ui:define name="headerCancelButton">
        <div class="defbutton">
            <p:commandLink action="#{group.cancel}" rendered="#{group.editState or group.createState}" update="@all">
                <h:graphicImage value="#{resource['images:button-cancel.png']}"/>
                Отменить
            </p:commandLink>
        </div>
    </ui:define>
    <ui:define name="headerSaveButton">
        <div class="defbutton">
            <p:commandLink action="#{group.save}" rendered="#{group.editState or group.createState}" update="@all">
                <h:graphicImage value="#{resource['images:save_buttn.png']}"/>
                Сохранить
            </p:commandLink>
        </div>
    </ui:define>
    <ui:define name="headerDeleteButton">
        <div class="defbutton">
            <p:commandLink action="#{group.delete()}"
                           rendered="#{isAdministrator or (group.document.author.id eq sessionManagement.getLoggedUser().id)}">
                <h:graphicImage value="#{resource['images:dell_buttn.png']}"/>
                Удалить
                <f:param name="docAction" value="delete"/>
            </p:commandLink>
        </div>
    </ui:define>


    <ui:define name="contentItemInfo">
        <h:panelGroup rendered="#{group.viewState}">
            <div class="row">
                <table class="form_grid">
                    <tr class="row">
                        <td class="first">Категория:</td>
                        <td class="second" colspan="3">
                            <h:outputText value="#{group.document.groupType.value}" class="wide"/>
                        </td>
                    </tr>
                    <tr class="row">
                        <td class="first">Наименование:</td>
                        <td class="second" colspan="3">
                            <h:outputText value="#{group.document.value}" class="wide"/>
                        </td>
                    </tr>
                    <tr class="row">
                        <td class="first">Алиас:</td>
                        <td class="second" colspan="3">
                            <h:outputText value="#{group.document.code}" class="wide"/>
                        </td>
                    </tr>
                    <tr class="row">
                        <td class="first">Пользователи:</td>
                        <td class="second" colspan="3">
                            <div style="overflow-y: scroll; height: 90px">
                               <ui:repeat value="#{group.document.membersList}" var="member">
                                    <h:outputText value="#{member.getDescription()}" class="width"/><br/>
                                </ui:repeat>
                            </div>
                        </td>
                    </tr>
                    <tr class="row">
                        <td class="first"/>
                        <td class="second"/>
                        <td class="third"/>
                        <td class="fourth"/>
                    </tr>
                </table>
            </div>
        </h:panelGroup>
        <h:panelGroup rendered="#{group.createState or group.editState}">
            <div class="row">
                <table class="form_grid">
                    <tr class="row">
                        <td class="first">Категория:</td>
                        <td class="second">
                            <p:selectOneMenu id="groupType" value="#{group.document.groupType}" converter="GroupTypeConverter">
                            <f:selectItems value="#{dictionaryManagement.groupTypes}"/>
                        </p:selectOneMenu>
                        </td>
                    </tr>
                    <tr class="row">
                        <td class="first">Наименование:</td>
                        <td class="second">
                            <p:inputText value="#{group.document.value}"/>
                        </td>
                    </tr>
                    <tr class="row">
                        <td class="first">Алиас:</td>
                        <td class="second">
                            <p:inputText value="#{group.document.code}"/>
                        </td>
                    </tr>
                    <tr class="row">
                        <td class="first">
                            <p:commandLink actionListener="#{group.chooseMembers}" ajax="true" value="Пользователи">
                                <p:ajax event="dialogReturn" listener="#{group.onMembersChosen}" update="members"/>
                            </p:commandLink>
                        </td>
                        <td class="second" colspan="3">
                            <div style="overflow-y: scroll; height: 400px">
                                <h:panelGroup id="members">
                                   <ui:repeat value="#{group.document.membersList}" var="member">
                                        <h:outputText value="#{member.getDescription()}"/><br/>
                                    </ui:repeat>
                                </h:panelGroup>
                            </div>
                        </td>
                    </tr>
                    <tr class="row">
                        <td class="first"/>
                        <td class="second"/>
                        <td class="third"/>
                        <td class="fourth"/>
                    </tr>
                </table>
            </div>
        </h:panelGroup>
    </ui:define>

</ui:composition>

</html>