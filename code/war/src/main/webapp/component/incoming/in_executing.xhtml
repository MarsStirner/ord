<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
>


<ui:composition template="/jsf-template/listTemplate.xhtml">
    <f:metadata>
        <f:viewAction action="#{in_documents_by_executing_date.refresh}"/>
    </f:metadata>

    <ui:define name="HEAD">
        <style type="text/css">
            .year {
                color: yellow !important;
                text-shadow: 1px 1px 1px black, 0 0 1px red; /* Параметры тени */
            }

            .month {
                color: red !important;
                text-shadow: 1px 1px 1px black, 0 0 1px red; /* Параметры тени */
                text-transform: uppercase;
            }

            .ui-treetable tbody td {
                white-space: normal !important;
            }

            .ui-state-default, .ui-widget-content .ui-state-default, .ui-widget-header .ui-state-default {
                cursor: inherit;
            }
        </style>
    </ui:define>

    <ui:define name="CONTENT.VIEWTITLE">
        <h:outputText id="viewTitleText" value="Входящие документы
                #{in_documents_by_executing_date.showExpiredFlag ? 'с просроченной датой исполнения' : 'по сроку исполнения'}"/>
        <p:tooltip id="toolTipForViewTitleText" for="viewTitleText" showDelay="1000" hideDelay="500">
            Просмотр входящих документов, у которых:
            <br/>1) пользователь является руководителем.
            <br/>2) Уровень доступа документа ниже или равен ТЕКУЩЕМУ уровню допуска пользователя
            <br/>3) Дата исполнения указана
            <br/>4) Документ находится в одном из статусов (На регистрации\ На исполнении\ Зарегистрирован)
            <br/>5) Документ не удален
            <br/>6) Если выбран флаг "Просроченные", то дата исполнения должна быть в прошлом
        </p:tooltip>
    </ui:define>


    <ui:define name="CONTENT.TOOLBAR">
        <p:toolbarGroup align="left">
            <p:button value="Новый документ" outcome="#{ui['document.incoming.page.link']}" target="_blank" icon="ui-icon-plusthick">
                <f:param name="docAction" value="create"/>
            </p:button>
            <p:commandButton action="#{in_documents_by_executing_date.refresh}" value="Обновить" update="documentTable" icon="ui-icon-refresh" ajax="true"/>
            <p:commandButton value="Свернуть" action="#{in_documents_by_executing_date.collapseAll}" icon="ui-icon-minusthick" update="documentTable"/>
            <p:commandButton value="Развернуть" action="#{in_documents_by_executing_date.expandAll}" icon="ui-icon-plusthick" update="documentTable"/>
            <p:commandButton value="#{in_documents_by_executing_date.showExpiredFlag ? 'Показать все':'Показать только просроченные'}"
                             action="#{in_documents_by_executing_date.changeExpiredFlag}" update=" @this documentTable viewTitleText"/>
        </p:toolbarGroup>
        <p:toolbarGroup align="right">
            <p:inputText id="filterString" value="#{in_documents_by_executing_date.filter}" title="Поиск"
                         placeholder="#{ui['document.incoming.list.search.placeholder']}" style="width:25em;"/>
            <p:commandButton value="Найти" id="searchButton" action="#{in_documents_by_executing_date.refresh}" process="@this filterString"
                             update="documentTable" icon="ui-icon-search"/>
            <p:defaultCommand target="searchButton"/>
            <p:button target="_blank" outcome="#{ui['document.incoming.search.link']}" value="Расширенный поиск" icon="ui-icon-star"/>
        </p:toolbarGroup>

    </ui:define>

    <ui:define name="CONTENT.TABLE">
        <p:treeTable id="documentTable"  widgetVar="treeTableVar"
                     value="#{in_documents_by_executing_date.root}" var="node"
                     style="width:100%; overflow-x:hidden;"
                     emptyMessage="#{ui['document.incoming.list.emptyMessage']}"
                     selectionMode="single"
                     rowStyleClass="#{node.document.styleClass}">
            <p:column headerText="Срок исполнения">
                <h:outputText value="#{node.header}"/>
            </p:column>
            <p:column headerText="Номер">
                <h:outputText value="#{node.document.registrationNumber}"/>
            </p:column>
            <p:column headerText="Корреспондент">
                <h:outputText value="#{node.document.contragent.shortName}"/>
            </p:column>
            <p:column headerText="Исполнитель">
                <ui:repeat value="#{node.document.executorsList}" var="executor">
                    <h:outputText value="#{executor}" converter="#{PersonConverter}"/><br/>
                </ui:repeat>
            </p:column>
            <p:column headerText="Вид">
                <h:outputText value="#{node.document.form}"/>
            </p:column>
            <p:column headerText="Статус">
                <h:outputText value="#{node.document.getDocumentStatus().getName()}"/>
            </p:column>
            <p:column headerText="Краткое содержание">
                <h:outputText value="#{node.document.shortDescription}"/>
            </p:column>
            <p:column style="display:none;">#{node.document.id}</p:column>
            <p:ajax event="select" oncomplete="if(parseInt(PrimeFaces.widgets.treeTableVar.cursorNode.children()[7].textContent)){ goToIncomingDocument(PrimeFaces.widgets.treeTableVar.cursorNode.children()[7].textContent);}"/>
        </p:treeTable>
    </ui:define>
</ui:composition>
</html>
