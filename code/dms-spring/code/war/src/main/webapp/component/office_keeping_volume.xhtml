<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:e5ui="http://efive.ru/uitemplates"
	xmlns:e5ui-comp="http://efive.ru/uitemplates/composite">

<ui:composition template="/WEB-INF/jsf-template/template.xhtml">

	<ui:define name="running_head">
		<!-- #{officeKeepingVolume.document.id}  -->
		<e5ui-comp:userSessionUpdate interval="300" />
	</ui:define>

	<ui:define name="left_menu"></ui:define>

	<ui:define name="header">
		<div id="form_header">
			<div class="actionbar">
				<div class="menu">
					<div class="defbutton">
						<h:commandLink action="#{officeKeepingVolume.edit}"
							rendered="#{officeKeepingVolume.viewState}">
							<h:graphicImage value="#{resource['images:edit_buttn.png']}" />
							Редактировать
						</h:commandLink>
					</div>
					<div class="defbutton">
						<h:commandLink action="#{officeKeepingVolume.cancel}"
							rendered="#{officeKeepingVolume.editState or officeKeepingVolume.createState}">
							<h:graphicImage value="#{resource['images:button-cancel.png']}" />
							Отменить
						</h:commandLink>
					</div>
					<div class="defbutton">
						<h:commandLink action="#{officeKeepingVolume.save}"
							rendered="#{officeKeepingVolume.editState or officeKeepingVolume.createState}">
							<h:graphicImage value="#{resource['images:save_buttn.png']}" />
							Сохранить
						</h:commandLink>
					</div>
					<div class="defbutton">
						<h:commandLink action="#{officeKeepingVolume.delete()}"
							rendered="#{officeKeepingVolume.editState and officeKeepingVolume.document.getDocumentStatus().getId() eq 1}">
							<h:graphicImage value="#{resource['images:dell_buttn.png']}" />
							Удалить
							<f:param name="docAction" value="delete" />
						</h:commandLink>
					</div>
					<div class="defbutton">
						<e5ui:formPart id="actions_fp">
							<h:commandLink
								onclick="actionsModal.clickOpen('actionsModal'); return false;">
								<h:graphicImage value="#{resource['images:button-do.png']}" />
								Действия								
							</h:commandLink>
							<e5ui-comp:modalWindow id="actionsModal"
								modalWindowHolder="#{officeKeepingVolume.processorModal}"
								render="main_content_form:" execute="@this" showButtons="false"
								widgetVar="actionsModal">
								<h:panelGroup
									rendered="#{not(officeKeepingVolume.processorModal.processingState)}">
									<div id="title">Действия</div>
								</h:panelGroup>
								<h:panelGroup
									rendered="#{officeKeepingVolume.processorModal.actionsAvailable}">
									<div class="wrap"
										style="height: 90px; background-color: #fff; clear: both;">
										<div class="inner" style="height: 90px;">
											<e5ui:dataTable id="action_select_table" border="0"
												cellpadding="0" cellspacing="0"
												value="#{officeKeepingVolume.processorModal.availableActions}"
												var="row" grouping="false" width="100%">
												<e5ui:row
													onclick="e5ui_util.clickElement(this, 'selectLink$');"
													styleClass="#{officeKeepingVolume.processorModal.selected(row)? 'grid_row_selected': ''}" />
												<e5ui:column>
													<f:facet name="header">
														<p>Доступные действия</p>
													</f:facet>
													<h:outputText value="#{row.name}" />
													<h:commandLink id="selectLink" style="display: none;"
														rendered="#{not officeKeepingVolume.processorModal.selected(row)}"
														action="#{officeKeepingVolume.processorModal.select(row)}" />
												</e5ui:column>
											</e5ui:dataTable>
										</div>
									</div>
								</h:panelGroup>
								<h:panelGroup
									rendered="#{officeKeepingVolume.processorModal.noActionsAvailable or officeKeepingVolume.processorModal.failureState or officeKeepingVolume.processorModal.processedState}">
									<h:outputText style="padding-left:10px;"
										value="#{officeKeepingVolume.processorModal.actionResult}" />
								</h:panelGroup>
								<h:panelGroup
									rendered="#{officeKeepingVolume.processorModal.processingState}">
									<e5ui:include
										data="#{officeKeepingVolume.processorModal.processedActivity.document.form}" />
								</h:panelGroup>
								<div class="e5ui-modal-bottombuttons">
									<h:commandButton
										action="#{officeKeepingVolume.processorModal.process()}"
										rendered="#{officeKeepingVolume.processorModal.actionsAvailable or officeKeepingVolume.processorModal.processingState}"
										value="Выполнить">
									</h:commandButton>
									<h:button
										rendered="#{officeKeepingVolume.processorModal.actionsAvailable or officeKeepingVolume.processorModal.processingState}"
										onclick="actionsModal.clickClose(); return false;"
										value="Отмена" />
									<h:button
										rendered="#{officeKeepingVolume.processorModal.noActionsAvailable or officeKeepingVolume.processorModal.failureState or officeKeepingVolume.processorModal.processedState}"
										onclick="actionsModal.clickClose(); return false;"
										value="Закрыть" />
								</div>
							</e5ui-comp:modalWindow>
						</e5ui:formPart>
					</div>

				</div>
			</div>
		</div>
	</ui:define>

	<ui:define name="content">
		<div id="header_content">
			<h:outputScript>
			   function goToFileById(parentId) {			
				   	if (parentId != "") {						   		        							   		
			    		window.open('#{facesContext.externalContext.requestContextPath}/component/office_keeping_file.xhtml?docId=' + parentId,'_blank');
			    	}	
				}								
			 </h:outputScript>
			<h:panelGroup rendered="#{officeKeepingVolume.createState}">
				<div class="name">
					Новый том для дела №
					<h:outputText
						value="#{officeKeepingVolume.document.parentFile.fileIndex}" />
					(
					<h:outputText
						value="#{officeKeepingVolume.document.parentFile.shortDescription}" />
					)
				</div>
				<div class="title">
					<h:outputText value="#{officeKeepingVolume.document.getDocumentStatus().getName()}" />
				</div>
			</h:panelGroup>
			<h:panelGroup
				rendered="#{officeKeepingVolume.editState or officeKeepingVolume.viewState}">
				<div class="name">
					<div>
						Том №
						<h:outputText value="#{officeKeepingVolume.document.volumeIndex}" />
						находится в деле
						<h:outputLink style="margin-left:5px;" value="#"
							onclick="goToFileById('#{officeKeepingVolume.document.parentFile.id}');">
							<h:outputText
								value="#{officeKeepingVolume.document.parentFile.fileIndex}" />
						</h:outputLink>
						(
						<h:outputText
							value="#{officeKeepingVolume.document.parentFile.shortDescription}" />
						)
					</div>
				</div>
				<div class="title">
					<h:outputText value="#{officeKeepingVolume.document.getDocumentStatus().getName()}" />
				</div>
			</h:panelGroup>
			<h:panelGroup rendered="#{officeKeepingVolume.notFoundState}">
				<div class="name">404 - Роль не найдена</div>
			</h:panelGroup>
			<h:panelGroup rendered="#{officeKeepingVolume.forbiddenState}">
				<div class="name">403 - Действие запрещено</div>
			</h:panelGroup>

			<h:panelGroup
				rendered="#{not(officeKeepingVolume.createState or officeKeepingVolume.editState or officeKeepingVolume.viewState or officeKeepingVolume.notFoundState or officeKeepingVolume.forbiddenState)}">
				<div class="name">В доступе отказано</div>
			</h:panelGroup>

		</div>

		<div class="main_content">
			<e5ui:formPart id="editFormPart">
				<h:panelGroup
					rendered="#{(officeKeepingVolume.editState and (officeKeepingVolume.document.getDocumentStatus().getId() eq 10))}">
					<div class="row">
						<table class="form_grid">
							<tr class="row">
								<td class="first"><label> <span class="title">
											<h:outputLink
												onclick="collectorSelectModalVar.clickOpen('collectorSelectModal'); return false;">
												Кому передан на руки:
											</h:outputLink> </span> </label> <e5ui-comp:modalWindow id="collectorSelectModal"
										modalWindowHolder="#{officeKeepingVolume.collectorSelectModal}"
										render=":main_content_form:collector" execute="select_table"
										showButtons="false" style="width: 500px;"
										widgetVar="collectorSelectModalVar">
										<div id="title">Выбор пользователя</div>
										<div id="modal_container" style="margin-top: 0;">
											<div class="searchbar">
												<span style="float: left; margin-top: 3px">Поиск:&nbsp;</span>
												<h:inputText id="filter_string"
													value="#{officeKeepingVolume.collectorSelectModal.userList.filter}"
													style="display:block; float:left; margin-right:10px;"
													title="Поиск" />
												<h:commandButton value=" "
													action="#{officeKeepingVolume.collectorSelectModal.userList.changePageOffset(0)}"
													styleClass="searchbutton">
													<f:ajax
														execute=":main_content_form:collectorSelectModal:filter_string"
														render=":main_content_form:collectorSelectModal:ajaxModal :main_content_form:collectorSelectModal:collector_modal_paging" />
												</h:commandButton>
											</div>
											<div class="wrap" style="height: 300px;">
												<div class="inner" style="height: 300px;">
													<e5ui:dataTable id="select_table" border="0"
														cellpadding="0" cellspacing="0"
														value="#{officeKeepingVolume.collectorSelectModal.userList.documents}"
														var="row" grouping="false" width="100%">
														<e5ui:row
															onclick="e5ui_util.clickElement(this, 'selectLink$');"
															styleClass="#{officeKeepingVolume.collectorSelectModal.selected(row)? 'grid_row_selected': ''}" />
														<e5ui:column>
															<f:facet name="header">
																<p>Пользователь</p>
															</f:facet>
															<h:outputText value="#{row}" converter="PersonConverter" />
															<h:commandLink id="selectLink" style="display: none;"
																rendered="#{not officeKeepingVolume.collectorSelectModal.selected(row)}"
																action="#{officeKeepingVolume.collectorSelectModal.select(row)}" />
														</e5ui:column>
													</e5ui:dataTable>
												</div>
											</div>
											<div style="clear: both;">
												<h:panelGroup id="collector_modal_paging">
													<e5ui-comp:tablePager id="collector_pager"
														documentListHolder="#{officeKeepingVolume.collectorSelectModal.userList}" />
												</h:panelGroup>
											</div>
										</div>
										<div class="e5ui-modal-bottombuttons">
											<h:button
												onclick="collectorSelectModalVar.clickSave(); return false;"
												value="Выбрать" />
											<h:button
												onclick="collectorSelectModalVar.clickClose(); return false;"
												value="Отмена" />
										</div>
									</e5ui-comp:modalWindow></td>
								<td class="second"><h:outputText id="collector"
										value="#{officeKeepingVolume.document.collector}"
										converter="PersonConverter" class="wide" /></td>
								<td class="third"><label
									for="main_content_form:returnDate:dateEditor"> <span
										class="title">Срок возврата</span> </label>
								</td>
								<td class="fourth"><e5ui-comp:inputDate id="returnDate"
										value="#{officeKeepingVolume.document.returnDate}" lang="ru"
										immediate="true" />
								</td>
							</tr>
						</table>
					</div>
				</h:panelGroup>
				<h:panelGroup
					rendered="#{(officeKeepingVolume.viewState and (officeKeepingVolume.document.getDocumentStatus().getId() ge 10))or (officeKeepingVolume.editState and (officeKeepingVolume.document.getDocumentStatus().getId() gt 10))}">
					<div class="row">
						<table class="form_grid">
							<tr class="row">
								<td class="third"><label> <span class="title">Кому
											передан на руки:</span> </label></td>
								<td class="fourth"><h:outputText
										value="#{officeKeepingVolume.document.collector}"
										converter="PersonConverter" class="wide" />
								</td>
								<td class="first"><label><span class="title">Срок
											возврата</span> </label>
								</td>
								<td class="second"><h:outputText
										value="#{officeKeepingVolume.document.returnDate}" lang="ru">
										<f:convertDateTime type="date" pattern="dd.MM.yyyy" />
									</h:outputText>
								</td>
							</tr>
						</table>
					</div>
				</h:panelGroup>
				<e5ui:tabPanel id="content_table">
					<e5ui:tabPage
						headerText="#{officeKeepingVolume.requisitesTabHeader}"
						actionBehavior="#{officeKeepingVolume.viewState? 'client': 'submit'}"
						selected="#{officeKeepingVolume.requisitesTabSelected}">
						<h:panelGroup rendered="#{officeKeepingVolume.viewState}">
							<div class="row">
								<table class="form_grid">
									<tr class="row">
										<td class="first">Заголовок:</td>
										<td><h:outputText
												value="#{officeKeepingVolume.document.shortDescription}"
												class="wide" /></td>
									</tr>
									<tr class="row">
										<td class="first">Срок хранения и № статей по перечню:</td>
										<td><h:outputText
												value="#{officeKeepingVolume.document.keepingPeriodReasons}"
												class="wide" /></td>
									</tr>
									<tr class="row">
										<td class="first">Примечания:</td>
										<td><h:outputText
												value="#{officeKeepingVolume.document.comments}"
												class="wide" />
										</td>
									</tr>
									<tr class="row">
										<td class="first">Лимит количества ед. хранения:</td>
										<td><h:outputText
												value="#{officeKeepingVolume.document.limitUnitsCount}"
												class="wide" /></td>
									</tr>
									<tr class="row">
										<td class="first">Количество ед. хранения:</td>
										<td><h:outputText
												value="#{officeKeepingVolume.document.unitsCount}"
												class="wide" /></td>
									</tr>
								</table>
							</div>
						</h:panelGroup>
						<h:panelGroup
							rendered="#{officeKeepingVolume.createState or officeKeepingVolume.editState}">
							<div class="row">
								<table class="form_grid">
									<tr class="row">
										<td class="first">Заголовок:</td>
										<td><h:inputText
												value="#{officeKeepingVolume.document.shortDescription}"
												class="wide" immediate="true" /></td>
									</tr>
									<tr class="row">
										<td class="first">Срок хранения и № статей по перечню::</td>
										<td><h:inputText
												value="#{officeKeepingVolume.document.keepingPeriodReasons}"
												class="wide" immediate="true" /></td>
									</tr>
									<tr class="row">
										<td class="first">Примечания:</td>
										<td><h:inputText
												value="#{officeKeepingVolume.document.comments}"
												class="wide" immediate="true" />
										</td>
									</tr>
									<tr class="row">
										<td class="first">Лимит количества ед. хранения:</td>
										<td><h:inputText
												value="#{officeKeepingVolume.document.limitUnitsCount}"
												class="wide" immediate="true" /></td>
									</tr>
									<tr class="row">
										<td class="first">Количество ед. хранения:</td>
										<td><h:outputText
												value="#{officeKeepingVolume.document.unitsCount}"
												class="wide" /></td>
									</tr>
								</table>
							</div>
						</h:panelGroup>
					</e5ui:tabPage>
					<e5ui:tabPage
						headerText="#{officeKeepingVolume.documentsTabHeader}"
						actionBehavior="client"
						selected="#{officeKeepingVolume.documentsTabSelected}">
						<fieldset>
							<legend></legend>
							<script type="text/javascript">
								document.ondblclick = function DoubleClick(evt) {
									if (window.getSelection)
										window.getSelection().removeAllRanges();
									else if (document.selection)
										document.selection.empty();
								}
							</script>
							<h:outputScript>
			        function goToDocument(id) {
			        		if (id != "") {
			        			window.open('#{facesContext.externalContext.requestContextPath}/component/paper_copy_document.xhtml?docId=' + id,'_blank');
							}
						}
			        </h:outputScript>
							<div class="actionbar">
								<div class="menu">
									<div class="defbutton">
										<h:commandLink
											action="paperCopyDocumentsByOfficeVolume.refresh()">
											<f:ajax render=":main_content_form:select_table" />
											<h:graphicImage
												value="#{resource['images:button-refresh.png']}" />									
	            						Обновить
	           						</h:commandLink>
									</div>
								</div>
							</div>
							<h:panelGroup>
								<div id="modal_container" style="margin-top: 0;">
									<div class="wrap"
										style="height: 250px; width: 100%; margin: 0px;">
										<div class="inner" style="height: 250px;">
											<e5ui:dataTable id="select_table" border="0" cellpadding="0"
												cellspacing="0"
												value="#{paperCopyDocumentsByOfficeVolume.getDocuments(officeKeepingVolume.document.id)}"
												var="row" style="width:100%">
												<e5ui:row ondblclick="goToDocument('#{row.id}');" />
												<e5ui:column>
													<f:facet name="header">
														<p>Номер</p>
													</f:facet>
													<h:outputText value="#{row.registrationNumber}" />
												</e5ui:column>
												<e5ui:column style="min-width:15em">
													<f:facet name="header">
														<p>Заголовок</p>
													</f:facet>
													<h:outputText value="#{row.shortDescription}" />
												</e5ui:column>
												<e5ui:column>
													<f:facet name="header">
														<p>Статус</p>
													</f:facet>
													<h:outputText value="#{row.getDocumentStatus().getName()}" />
												</e5ui:column>
											</e5ui:dataTable>
										</div>
									</div>
									<div id="table_paging">
										<e5ui-comp:tablePager
											documentListHolder="#{paperCopyDocumentsByOfficeVolume}"
											style="display:inline;" />
										<e5ui-comp:tablePageSizeSelector
											documentListHolder="#{paperCopyDocumentsByOfficeVolume}"
											style="display:inline;float:right;" pageSizes="10,25,50,100" />
									</div>
								</div>
							</h:panelGroup>
						</fieldset>
					</e5ui:tabPage>
					<e5ui:tabPage headerText="#{officeKeepingVolume.locationTabHeader}"
						actionBehavior="client"
						selected="#{officeKeepingVolume.locationTabSelected}">
						<h:panelGroup rendered="#{officeKeepingVolume.viewState}">
							<div class="row">
								<table class="form_grid">
									<tr class="row">
										<td class="first"><label><span class="title">Фонд</span>
										</label>
										</td>
										<td class="second"><h:outputText
												value="#{officeKeepingVolume.document.fundNumber}"
												class="short" />
										</td>
										<td class="third"></td>
										<td class="fourth"></td>
									</tr>
									<tr class="row">
										<td class="first"><label><span class="title">Стеллаж</span>
										</label></td>
										<td class="second"><h:outputText
												value="#{officeKeepingVolume.document.standNumber}"
												class="short" />
										</td>
										<td class="third"></td>
										<td class="fourth"></td>
									</tr>
									<tr class="row">
										<td class="first"><label> <span class="title">Полка</span>
										</label></td>
										<td class="second"><h:outputText
												value="#{officeKeepingVolume.document.shelfNumber}"
												class="short" />
										</td>
										<td class="third"></td>
										<td class="fourth"></td>
									</tr>
									<tr class="row">
										<td class="first"><label> <span class="title">Короб</span>
										</label></td>
										<td class="second"><h:outputText
												value="#{officeKeepingVolume.document.boxNumber}"
												class="short" />
										</td>
										<td class="third"></td>
										<td class="fourth"></td>
									</tr>
								</table>
							</div>
						</h:panelGroup>
						<h:panelGroup
							rendered="#{officeKeepingVolume.createState or officeKeepingVolume.editState}">
							<div class="row">
								<table class="form_grid">
									<tr class="row">
										<td class="first"><label
											for="main_content_form:fundNumber"><span
												class="title">Фонд</span> </label>
										</td>
										<td class="second"><h:inputText
												value="#{officeKeepingVolume.document.fundNumber}"
												id="fundNumber" class="short" />
										</td>
										<td class="third"></td>
										<td class="fourth"></td>
									</tr>
									<tr class="row">
										<td class="first"><label
											for="main_content_form:standNumber"><span
												class="title">Стеллаж</span> </label></td>
										<td class="second"><h:inputText
												value="#{officeKeepingVolume.document.standNumber}"
												id="standNumber" class="short" />
										</td>
										<td class="third"></td>
										<td class="fourth"></td>
									</tr>
									<tr class="row">
										<td class="first"><label
											for="main_content_form:shelfNumber"> <span
												class="title">Полка</span> </label></td>
										<td class="second"><h:inputText
												value="#{officeKeepingVolume.document.shelfNumber}"
												id="shelfNumber" class="short" />
										</td>
										<td class="third"></td>
										<td class="fourth"></td>
									</tr>
									<tr class="row">
										<td class="first"><label
											for="main_content_form:boxNumber"> <span
												class="title">Короб</span> </label></td>
										<td class="second"><h:inputText
												value="#{officeKeepingVolume.document.boxNumber}"
												id="boxNumber" class="short" />
										</td>
										<td class="third"></td>
										<td class="fourth"></td>
									</tr>
								</table>
							</div>
						</h:panelGroup>
					</e5ui:tabPage>

					<e5ui:tabPage headerText="#{officeKeepingVolume.historyTabHeader}"
						actionBehavior="client"
						selected="#{officeKeepingVolume.historyTabSelected}">
						<div class="row">
							<div class="wrap" style="width: 100%; margin: 0px">
								<div class="inner">
									<e5ui:dataTable border="0" cellpadding="0" cellspacing="0"
										id="history_list"
										value="#{officeKeepingVolume.document.historyList}" var="row"
										grouping="false">
										<e5ui:column>
											<f:facet name="header">
												<p>Дата</p>
											</f:facet>
											<h:outputText value="#{row.startDate}">
												<f:convertDateTime type="date" pattern="dd.MM.yyyy HH:mm" />
											</h:outputText>
										</e5ui:column>
										<e5ui:column>
											<f:facet name="header">
												<p>Статус</p>
											</f:facet>
											<h:outputText value="#{row.fromStatusName}" />
										</e5ui:column>
										<e5ui:column>
											<f:facet name="header">
												<p>Действие</p>
											</f:facet>
											<h:outputText value="#{row.actionName}" />
										</e5ui:column>
										<e5ui:column>
											<f:facet name="header">
												<p>Автор</p>
											</f:facet>
											<h:outputText value="#{row.owner.descriptionShort}" />
										</e5ui:column>
										<e5ui:column>
											<f:facet name="header">
												<p>Комментарий</p>
											</f:facet>
											<h:outputText value="#{row.commentary}" />
										</e5ui:column>
									</e5ui:dataTable>
								</div>
							</div>
						</div>
					</e5ui:tabPage>

				</e5ui:tabPanel>
			</e5ui:formPart>
		</div>

	</ui:define>

	<ui:define name="footer">
		<e5ui-comp:splashScreen id="splash_screen" timeout="0">
			<f:facet name="timeoutPanel">
				<div
					style="background-color: white; border-top: solid 1px black; border-bottom: solid 1px black; padding: 30px; text-align: center; margin: 200px auto; width: 300px;">
					Пожалуйста, подождите...</div>
			</f:facet>
		</e5ui-comp:splashScreen>
		<script>
			e5ui_splashScreen.startShowOnSubmit('splash_screen',
					[ 'main_content_form' ]);
		</script>
		<h:outputStylesheet library="css" name="datatable.css" />
		<h:outputStylesheet library="css" name="modalWindow.css" />
		<h:outputStylesheet library="css" name="multiMarker.css" />
		<h:outputStylesheet library="css" name="tabPanel.css" />
	</ui:define>

</ui:composition>

</html>