<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd"
                   objectQuotingStrategy="QUOTE_ALL_OBJECTS"
                   logicalFilePath="serbsky/numerator.xml">
    <changeSet id="serbsky/numerator" author="e.upatov" context="SERBSKY">
        <comment>Настраиваемый справочник нумераторов</comment>
        <createTable tableName="numerator" remarks="Настраиваемый справочник нумераторов">
            <column name="id" autoIncrement="true" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="deleted" remarks="Признак удаления записи" type="BIT(1)" defaultValueNumeric="0">
                <constraints nullable="false"/>
            </column>
            <column name="prefix" type="VARCHAR(64)" remarks="Префикс номера нумератора (ранее номенклатура)" defaultValue="">
                <constraints nullable="false"/>
            </column>
            <column name="startNumber" type="INT" remarks="Стартовый номер нумератора (откуда начинается нумерация) +1" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="begDate" type="DATE" remarks="Дата начала действия нумератора">
                <constraints nullable="false"/>
            </column>
            <column name="endDate" type="DATE" remarks="Дата окончания действия нумератора">
                <constraints nullable="true"/>
            </column>
            <column name="priority" type="INT" remarks="приоритет нумератора над остальными" defaultValueNumeric="1000">
                <constraints nullable="false"/>
            </column>
            <column name="shortDescription" remarks="Краткое описание содержания документа" type="LONGTEXT"/>
            <!--К чему привязываются нумераторы-->
            <column name="documentType_id" type="INT" remarks="Тип документа, NULL - любой">
                <constraints nullable="true" foreignKeyName="FK_numerator__documentType" referencedTableName="rbDocumentType" referencedColumnNames="id"/>
            </column>
            <column name="documentForm_id" type="INT" remarks="Вид документа, NULL - любой">
                <constraints nullable="true" foreignKeyName="FK_numerator__documentForm" referencedTableName="rbDocumentForm" referencedColumnNames="id"/>
            </column>
            <column name="controller_id" type="INT" remarks="Руководитель, NULL - любой">
                <constraints nullable="true" foreignKeyName="FK_numerator__controller" referencedTableName="user" referencedColumnNames="id"/>
            </column>
            <column name="contragent_id" type="INT" remarks="Контрагент, NULL - любой">
                <constraints nullable="true" foreignKeyName="FK_numerator__contragent" referencedTableName="rbContragent" referencedColumnNames="id"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="serbsky/numerator_usage" author="e.upatov" context="SERBSKY">
        <comment>Таблица связка документов и используемых нумераторов с указанием номера</comment>
        <createTable tableName="numerator_usage" remarks="Таблица связка документов и используемых нумераторов с указанием номера">
            <column name="document_id" type="VARCHAR(64)" remarks="Уникальный ключ документа">
                <constraints primaryKey="true"/>
            </column>
            <column name="numerator_id" remarks="Ссылка на использованный нумератор" type="INT">
                <constraints nullable="false" foreignKeyName="FK_numerator_usage__numerator" referencedTableName="numerator" referencedColumnNames="id"/>
            </column>
            <column name="number" type="INT" remarks="Используемый номер в рамках нумератора">
                <constraints nullable="false"/>
            </column>
            <column name="registration_date" type="DATETIME" remarks="Дата+время регистрации документа">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
</databaseChangeLog>